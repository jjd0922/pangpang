-- mysql function

DELIMITER $$

DROP FUNCTION IF EXISTS JSON_ARR_TO_STR;

CREATE FUNCTION JSON_ARR_TO_STR(arr VARCHAR(2000)) RETURNS VARCHAR(2000)

BEGIN
 	DECLARE str VARCHAR(2000) DEFAULT '';
 	DECLARE i INT DEFAULT 0;
	   WHILE(i < JSON_LENGTH(arr)) DO
	   	SET str:= CONCAT_WS(', ', str, JSON_UNQUOTE(JSON_EXTRACT(arr, CONCAT('$[',i,']'))) );
	   	SET i:= i+1;
		END WHILE;

   RETURN SUBSTR(str,3);
END $$

DELIMITER ;
