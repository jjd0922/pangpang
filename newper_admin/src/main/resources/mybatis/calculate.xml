<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.CalculateMapper">

    <sql id="includeCalculateGroupDatatable">
        <if test="ccgType != null and ccgType != ''">AND CCG_TYPE = #{ccgType}</if>
        <if test="ccgIdx != null and ccgIdx != ''">AND CCG_IDX LIKE CONCAT ('%', #{ccgIdx}, '%')</if>
        <if test='ccgConfirmDate != null and ccgConfirmDate != ""'>AND CCG_CONFRIM_DATE BETWEEN SUBSTR(#{ccgConfirmDate}, 1, 10) AND SUBSTR(#{ccgConfirmDate}, 13)</if>
        <if test="ccgConfirmBy != null and ccgConfirmBy != ''">AND CCG_CONFIRM_BY LIKE CONCAT ('%', #{ccgConfirmBy}, '%')</if>
        <if test='ccgCloseDate != null and ccgCloseDate != ""'>AND CCG_CLOSE_DATE BETWEEN SUBSTR(#{ccgCloseDate}, 1, 10) AND SUBSTR(#{ccgCloseDate}, 13)</if>
        <if test="ccgCloseBy != null and ccgCloseBy != ''">AND CCG_CLOSE_BY LIKE CONCAT ('%', #{ccgCloseBy}, '%')</if>
        <if test="comName != null and comName != ''">AND COM_NAME LIKE CONCAT ('%', #{comName}, '%')</if>
        <if test='ccgDueDate != null and ccgDueDate != ""'>AND CCG_DUE_DATE BETWEEN SUBSTR(#{ccgDueDate}, 1, 10) AND SUBSTR(#{ccgConfirmDate}, 13)</if>
        <if test='ccgAdjust != null and ccgAdjust != ""'>
            <foreach collection="ccgAdjust" open="AND CCG_ADJUST IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgState != null and ccgState != ""'>
            <foreach collection="ccgState" open="AND CCG_STATE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgCloseState != null and ccgCloseState != ""'>
            <foreach collection="ccgCloseState" open="AND CCG_CLOSE_STATE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgCalType != null and ccgCalType != ""'>
            <foreach collection="ccgCalType" open="AND CCG_CAL_TYPE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
    </sql>

    <select id="selectCalculateGroupDatatable" resultType="Map">
        SELECT
            *
        FROM
            CALCULATE_GROUP
        <where>
            <include refid="includeCalculateGroupDatatable"></include>
        </where>
        ORDER BY
            CCG_IDX DESC
        <if test="length != -1">
        LIMIT
            #{start}, #{length}
        </if>
    </select>

    <select id="countCalculateGroupDatatable" resultType="Long">
        SELECT
            COUNT(*)
        FROM
            CALCULATE_GROUP
        <where>
            <include refid="includeCalculateGroupDatatable"></include>
        </where>
    </select>

    <sql id="includeVendorSettingDatatable">
        <if test="comName != null and comName != ''">AND COM_NAME LIKE CONCAT('%',#{comName},'%')</if>
        <if test='CS_TYPE != null'>
            <foreach collection="CS_TYPE" open="AND CS_TYPE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test="createdDate != null and createdDate != ''">AND VENDOR_SETTING.CREATED_DATE BETWEEN SUBSTR(#{createdDate}, 1, 10) AND SUBSTR(#{createdDate}, 13)</if>
    </sql>

    <select id="selectVendorSettingDatatable" resultType="Map" parameterType="Map">
        SELECT
            *
        FROM
            VENDOR_SETTING
                LEFT JOIN COMPANY ON VS_COM_IDX = COM_IDX
       <where>
           <include refid="includeVendorSettingDatatable"></include>
       </where>
    </select>

    <select id="countVendorSettingDatatable" resultType="Long">
        SELECT
            COUNT(*)
        FROM
            VENDOR_SETTING
                LEFT JOIN COMPANY ON VS_COM_IDX = COM_IDX
        <where>
            <include refid="includeVendorSettingDatatable"></include>
        </where>
    </select>

    <select id="selectOrderGsDatatable" resultType="Map">
        SELECT
            *
        FROM
            ORDER_GS
        ORDER BY
            OG_IDX DESC
        LIMIT
            #{start}, #{length}
    </select>

    <select id="countOrderGsDatatable" resultType="Long">
        SELECT
            COUNT(*)
        FROM
            ORDER_GS
    </select>

    <select id="selectAdjust" resultType="Map">
        SELECT
            *
        FROM
            CALCULATE_ADJUST
        WHERE
            CCA_OG_IDX = #{ogIdx}
    </select>

    <select id="selectCompanyByVendor" resultType="Map">
        SELECT
            *
        FROM
            COMPANY

    </select>

    <select id="selectExcelColumn" resultType="Map">
        SELECT
            *
        FROM
            EXCEL_COLUMN
    </select>
</mapper>