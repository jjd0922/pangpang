<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.CalculateMapper">

    <sql id="includeCalculateDatatable">
        <if test="COM_IDX != null and COM_IDX != ''">AND COM_IDX LIKE CONCAT('%',#{COM_IDX},'%')</if>
        <if test='CS_TYPE != null'>
        <foreach collection="CS_TYPE" open="AND CS_TYPE IN (" separator="," close=")" item="item">
            #{item}
        </foreach>
        </if>
        <if test="createdDate != null and createdDate != ''">AND calculateSetting.CREATED_DATE BETWEEN SUBSTR(#{createdDate}, 1, 10) AND SUBSTR(#{createdDate}, 13)</if>
    </sql>
    <select id="selectCalculateDatatable" resultType="Map" parameterType="Map">
        SELECT
        *
        FROM
            calculate_setting,
            calculate
            left join company on COM_IDX=CA_COM_IDX
       <where>
        <include refid="includeCalculateDatatable"></include>
       </where>
    </select>
    <select id="countCalculateDatatable" resultType="Integer">
        SELECT
        COUNT(*)
        FROM
            calculate_setting,
            calculate
            left join company on COM_IDX=CA_COM_IDX
        <where>
        <include refid="includeCalculateDatatable"></include>
        </where>
    </select>
</mapper>