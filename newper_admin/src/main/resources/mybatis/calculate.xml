<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.CalculateMapper">

    <sql id="includeCalculateGroupDatatable">
        <if test="ccgType != null and ccgType != ''">AND CCG_TYPE = #{ccgType}</if>
        <if test="ccgIdx != null and ccgIdx != ''">AND CCG_IDX LIKE CONCAT ('%', #{ccgIdx}, '%')</if>
        <if test='ccgConfirmDate != null and ccgConfirmDate != ""'>AND CCG_CONFRIM_DATE BETWEEN SUBSTR(#{ccgConfirmDate}, 1, 10) AND SUBSTR(#{ccgConfirmDate}, 13)</if>
        <if test="ccgConfirmBy != null and ccgConfirmBy != ''">AND CCG_CONFIRM_BY LIKE CONCAT ('%', #{ccgConfirmBy}, '%')</if>
        <if test='ccgCloseDate != null and ccgCloseDate != ""'>AND CCG_CLOSE_DATE BETWEEN SUBSTR(#{ccgCloseDate}, 1, 10) AND SUBSTR(#{ccgCloseDate}, 13)</if>
        <if test="ccgCloseBy != null and ccgCloseBy != ''">AND CCG_CLOSE_BY LIKE CONCAT ('%', #{ccgCloseBy}, '%')</if>
        <if test="comName != null and comName != ''">AND COM_NAME LIKE CONCAT ('%', #{comName}, '%')</if>
        <if test='ccgDueDate != null and ccgDueDate != ""'>AND CCG_DUE_DATE BETWEEN SUBSTR(#{ccgDueDate}, 1, 10) AND SUBSTR(#{ccgConfirmDate}, 13)</if>
        <if test='ccgAdjust != null and ccgAdjust != ""'>
            <foreach collection="ccgAdjust" open="AND CCG_ADJUST IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgState != null and ccgState != ""'>
            <foreach collection="ccgState" open="AND CCG_STATE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgCloseState != null and ccgCloseState != ""'>
            <foreach collection="ccgCloseState" open="AND CCG_CLOSE_STATE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
        <if test='ccgCalType != null and ccgCalType != ""'>
            <foreach collection="ccgCalType" open="AND CCG_CAL_TYPE IN (" separator="," close=")" item="item">
                #{item}
            </foreach>
        </if>
    </sql>

    <select id="selectCalculateGroupDatatable" resultType="Map">
        SELECT
            *
        FROM
            CALCULATE_GROUP
        <where>
            <include refid="includeCalculateGroupDatatable"></include>
        </where>
        ORDER BY
            CCG_IDX DESC
        <if test="length != -1">
        LIMIT
            #{start}, #{length}
        </if>
    </select>

    <select id="countCalculateGroupDatatable" resultType="Long">
        SELECT
            COUNT(*)
        FROM
            CALCULATE_GROUP
        <where>
            <include refid="includeCalculateGroupDatatable"></include>
        </where>
    </select>

    <sql id="includeCalculateDatatable">
        <if test="COM_IDX != null and COM_IDX != ''">AND COM_IDX LIKE CONCAT('%',#{COM_IDX},'%')</if>
        <if test='CS_TYPE != null'>
        <foreach collection="CS_TYPE" open="AND CS_TYPE IN (" separator="," close=")" item="item">
            #{item}
        </foreach>
        </if>
        <if test="createdDate != null and createdDate != ''">AND calculateSetting.CREATED_DATE BETWEEN SUBSTR(#{createdDate}, 1, 10) AND SUBSTR(#{createdDate}, 13)</if>
    </sql>
    <select id="selectCalculateDatatable" resultType="Map" parameterType="Map">
        SELECT
        *
        FROM
            calculate_setting,
            calculate
            left join company on COM_IDX=CA_COM_IDX
       <where>
        <include refid="includeCalculateDatatable"></include>
       </where>
    </select>
    <select id="countCalculateDatatable" resultType="Integer">
        SELECT
        COUNT(*)
        FROM
            calculate_setting,
            calculate
            left join company on COM_IDX=CA_COM_IDX
        <where>
        <include refid="includeCalculateDatatable"></include>
        </where>
    </select>

    <select id="selectOrderGsDatatable" resultType="Map">
        SELECT
            *
        FROM
            ORDER_GS
    </select>

    <select id="countOrderGsDatatable" resultType="Long">
        SELECT
            COUNT(*)
        FROM
            ORDER_GS
    </select>

    <select id="selectAdjust" resultType="Map">
        SELECT
            *
        FROM
            CALCULATE_ADJUST
        WHERE
            CCA_OG_IDX = #{ogIdx}
    </select>
</mapper>