<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.CategoryMapper">

    <select id="selectCategoryListByParent" resultType="map">
        SELECT
            P.*,
            if(C.CNT IS NULL,0,C.CNT) CNT
        FROM
            category P
                LEFT JOIN
            (
                SELECT
                    CATE_PARENT_IDX,COUNT(CATE_PARENT_IDX) CNT
                FROM
                    category
                where
                    CATE_PARENT_IDX is not null
                GROUP BY CATE_PARENT_IDX
            ) C
            ON P.CATE_IDX = C.CATE_PARENT_IDX
        WHERE
            P.CATE_PARENT_IDX IS NULL
        GROUP BY CATE_IDX
        order by CATE_ORDER
    </select>

    <select id="selectCategoryListByChildren" resultType="map">
        SELECT
            P.*,
            if(C.CNT IS NULL,0,C.CNT) CNT
        FROM
            category P
                LEFT JOIN
            (
                SELECT
                    CATE_PARENT_IDX,COUNT(CATE_PARENT_IDX) CNT
                FROM
                    category
                where
                    CATE_PARENT_IDX is not null
                GROUP BY CATE_PARENT_IDX
            ) C
            ON P.CATE_IDX = C.CATE_PARENT_IDX
        WHERE
            P.CATE_PARENT_IDX = #{CATE_PARENT_IDX}
        GROUP BY CATE_IDX
        order by CATE_ORDER
    </select>
    


</mapper>