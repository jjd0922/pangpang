<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.OrderMapper">

    <select id="selectOrderDatatable" resultType="map">
        SELECT
            O_IDX, O_CODE, SHOP_NAME, CU_ID, CU_NAME,
            CU_PHONE, O_LOCATION, PAY_STATE, PAY_METHOD, PAY_PRODUCT_PRICE,
            PAY_COUPON, PAY_USE_MILEAGE, PAY_POINT, PAY_DELIVERY, PAY_PRICE,
            if(PAY_STATE='결제취소',PAY_PRICE,0) AS PAY_CANCEL_PRICE,
            PAY_MILEAGE, AD_NAME, AD_PHONE, POST, CONCAT(ADDR1,' ',ADDR2,' ',ADDR3) AS ADDRS,
            ADDR4, AD_ENTRANCE, O_DATE, O_TIME
        FROM
            `orders`
                LEFT JOIN customer
                          ON CU_IDX=O_CU_IDX
                LEFT JOIN shop
                          ON O_SHOP_IDX=SHOP_IDX
                LEFT JOIN order_address
                          ON O_AD_IDX=AD_IDX
                LEFT JOIN payment
                          ON O_PAY_IDX=PAY_IDX

        orders by O_IDX desc
        <if test="length!=-1">
            LIMIT #{start},#{length}
        </if>
    </select>
    <select id="countOrderDatatable" resultType="Integer">
        SELECT
            count(*)
        FROM
            `orders`
                LEFT JOIN customer
                          ON CU_IDX=O_CU_IDX
                LEFT JOIN shop
                          ON O_SHOP_IDX=SHOP_IDX
                LEFT JOIN order_address
                          ON O_AD_IDX=AD_IDX
                LEFT JOIN payment
                          ON O_PAY_IDX=PAY_IDX
    </select>

</mapper>