<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.StockMapper">
    <select id="selectStockDatatableByParent" resultType="map">
        SELECT
            P_NAME, P_IDX, GS_CODE, count(GS_IDX) as cnt, GS_IDX,ifnull(dt.loc_cnt,0) loc_cnt,ifnull(ct.check_cnt,0) check_cnt

        FROM
            ORDERS
                LEFT JOIN ORDER_GS
                          ON OG_O_IDX=O_IDX
                LEFT JOIN delivery_num
                          ON OG_DN_IDX=DN_IDX
                LEFT JOIN shop_product_option
                          ON SPO_IDX=OG_SPO_IDX
                LEFT JOIN GOODS_STOCK
                          ON SPO_GS_IDX=GS_IDX
                LEFT JOIN PRODUCT
                          ON P_IDX=GS_P_IDX
                LEFT JOIN (SELECT
                               G_GS_IDX,COUNT(*) loc_cnt
                           FROM
                               goods
                                   LEFT JOIN location
                                             ON G_LOC_IDX=LOC_IDX
                           WHERE
                               G_LOC_IDX IS NOT NULL
                           GROUP BY G_GS_IDX
                           HAVING G_GS_IDX IS NOT null) dt
                          ON dt.G_GS_IDX=SPO_GS_IDX
                LEFT JOIN (SELECT
                               GS_IDX AS GS_IDX1,COUNT(*) check_cnt
                           FROM
                               goods_stock
                                   LEFT JOIN goods
                                             ON GS_IDX=G_GS_IDX
                                   LEFT JOIN check_goods
                                             ON G_IDX=CGS_G_IDX
                                   LEFT JOIN check_group
                                             ON CGS_CG_IDX=CG_IDX
                           WHERE
                               CGS_TYPE='출고검수'
                             AND CG_END_DATE IS NULL
                           GROUP BY GS_IDX
            )ct
                          ON ct.GS_IDX1=SPO_GS_IDX
        WHERE
            DN_IDX IS NOT NULL
        group by GS_IDX
    </select>

    <select id="selectStockDatatableByChildren" resultType="map">
        SELECT
            P_NAME,P_IDX,GS_CODE,G_BARCODE,WH_NAME,
            LOC_TYPE,LOC_CODE,LOC_FORM,LOC_ZONE,location.CREATED_DATE,
            U_NAME, G_IDX
        FROM
            goods
                LEFT JOIN location
                          ON G_LOC_IDX=LOC_IDX
                LEFT JOIN warehouse
                          ON LOC_WH_IDX=WH_IDX
                LEFT JOIN product
                          ON G_P_IDX=P_IDX
                LEFT JOIN goods_stock
                          on G_GS_IDX=GS_IDX
                left join user
                          on LOC_U_IDX=U_IDX
        WHERE
            G_LOC_IDX IS NOT NULL
            and G_GS_IDX=#{GS_IDX}
    </select>
    <select id="selectStockDataTable" resultType="map" parameterType="map">
        select
        *
        from
        goods_stock
    </select>

    <select id="countStockDataTable" resultType="integer">
        select
            count(*)
        from
        goods_stock
    </select>



</mapper>