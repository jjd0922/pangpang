<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<div class="modal" tabindex="-1" role="dialog" id="calculateModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-lg-12" id="goodsDiv">
                    <form id="calculateModalForm">
                        <div class="card mb-1">
                            <div class="card-body popup-contents mb-1">
                                <fieldset class="mb-0">
                                    <legend>정산정보</legend>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">총정산건수</span>
                                                    </span>
                                                    <input type="text" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">총마감대상금액</span>
                                                    </span>
                                                    <input type="text" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">정산대상자</span>
                                                    </span>
                                                    <input type="text" class="form-control" th:value="${@sessionInfo.getId()}">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">정산상태</span>
                                                    </span>
                                                    <select class="form-control">
                                                        <option th:each="opt: ${T(com.newper.constant.CcCalType).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">정산처리일</span>
                                                    </span>
                                                    <input type="text" class="form-control w-datarange daterange-single" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">정산메모</span>
                                                    </span>
                                                    <input type="text" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="mt-3">
                                    <legend>
                                        정산조정
                                        <span class="ml-2">
                                            <a class="btn btn-sm btn-primary ml-1">저장</a>
                                        </span>
                                        <span class="ml-2">
                                            <a class="btn btn-sm btn-primary ml-1" onclick="adjustAdd();">추가</a>
                                        </span>
                                    </legend>

                                    <div class="row overflow-x-scroll">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>조정항목</th>
                                                <th>조정사유</th>
                                                <th>조정금액</th>
                                                <th>삭제</th>
                                            </tr>
                                            </thead>
                                            <tbody id="adjustTbody">
                                            <tr class="adjust-tr adjust-tr-no-0">
                                                <td><input type="text" class="form-control" value="매입합계 조정" readonly></td>
                                                <td><input type="text" class="form-control" value="물품 하나 누락되어있음" readonly></td>
                                                <td><input type="text" class="form-control text-won adjust-cost" value="100,000" readonly></td>
                                                <td><a class="btn btn-sm btn-warning" onclick="adjustRemove(0)">삭제</a></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>


                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Footer -->
            <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
                <button type="button" class="btn btn-sm btn-secondary ml-1">닫기</button>
                <button type="button" class="btn btn-sm btn-primary ml-1">저장</button>
            </div>
            <!-- /footer -->
        </div>
    </div>
</div>

<script>
    function openCalculateModal () {
        $('#calculateModal').modal('show');
    }

    function adjustAdd() {
        var num = $('.adjust-tr').length;

        var html =
            '<tr class="adjust-tr adjust-tr-no-'+num+'">' +
            '<td><input type="text" class="form-control"></td>' +
            '<td><input type="text" class="form-control"></td>' +
            '<td><input type="text" class="form-control text-won adjust-cost"></td>' +
            '<td><a type="text" class="btn btn-sm btn-warning" onclick="adjustRemove('+num+')">삭제</a></td>' +
            '</tr>'

        $('#adjustTbody').append(html);
    }

    adjustSum();

    function adjustRemove(num) {
        $('.adjust-tr-no-'+num).remove();
        adjustSum();
    }

    function adjustSum(){
        var total_cost = 0;
        $.each($('.adjust-cost'), function (index, value) {
            total_cost += parseInt($(this).val().replace(/,/gi, ''));
        });

        $('#adjust_sum').val(comma(total_cost));
    }

    // 숫자만 입력되도록
    $(document).on('input', '.text-won', function (event) {
        inputOnlyNumber($(event.target));
        adjustSum();
    });
</script>
</html>
