<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${subTitle}">배송비 템플릿</title>
    <th:block th:replace="common/css.html"></th:block>
    <style>
        .group{
            background:aliceblue;
        }
    </style>
</head>

<body>

<th:block th:replace="common/header.html">Header</th:block>
<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <!-- Content area -->
            <div class="content container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header header-elements-inline">
                                <h6 class="card-title">
                                    <div class="breadcrumb breadcrumb-caret">
                                        <span class="breadcrumb-item">
                                            <i class="mr-1" th:classappend="${mainIcon}"></i>
                                            <th:block th:text="${mainTitle}"></th:block>
                                        </span>
                                        <span class="breadcrumb-item font-weight-bold text-secondary">
                                            <i class="mr-1" th:classappend="${subIcon}"></i>
                                            <th:block th:text="${subTitle}"></th:block>
                                        </span>
                                    </div>
                                </h6>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 카드 2열 레이아웃 -->
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="collapse show" id="collapse-button-collapsed">
                                <div class="card-body pt-0">
                                    <form id="pickingForm">
                                        <div class="row">
                                            <div class="col-lg-12 d-flex justify-content-center align-content-end align-items-end flex-wrap">
                                                <div class="form-group">
                                                    <label class="d-block">상호법인명</label>
                                                    <input type="text" class="form-control form-control-sm w-120px" placeholder="검색" name="">
                                                </div>
                                                <div class="form-group end">
                                                    <button type="button" class="btn btn-secondary" onclick="searchBtn()">
                                                        <span class="ladda-label"><i class="icon-search4 mr-1" onclick="searchBtn()"></i>조회하기</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <table class="table" id="companyTable">
                            </table>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="collapse show" >
                                <div class="card-body pt-0">
                                    <span id="store_name"></span>
                                    <!--<form>
                                        <div class="row">
                                            <div class="col-lg-12 d-flex justify-content-center align-content-end align-items-end flex-wrap">
                                                <div class="form-group">
                                                    <label class="d-block">출하지명</label>
                                                    <input type="text" class="form-control form-control-sm w-120px" placeholder="검색" name="">
                                                </div>
                                                <div class="form-group end">
                                                    <button type="button" class="btn btn-secondary" onclick="searchBtn()">
                                                        <span class="ladda-label"><i class="icon-search4 mr-1" onclick="searchBtn()"></i>조회하기</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>-->
                                </div>
                            </div>
                            <table class="table" id="deliveryTable">
                            </table>
                        </div>

                        <form id="templateForm">
                        <div class="card template" style="display: none">
                            <div class="card-body popup-contents mb-4">
                                <fieldset class="mb-0">
                                    <legend>템플릿 등록/수정관리<span class="small"></span>
                                        <div class="btn-group">
                                            <a type="button" class="btn btn-sm btn-danger" id="saveTemplateButton">
                                                저장
                                            </a>
                                        </div>
                                    </legend>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          배송비/설치비 종류설정
                                                        </span>
                                                    </span>
                                                    <div class="border p-1 form-control">
                                                        <div class="form-check form-check-inline">
                                                            <input type="radio" name="CD_TYPE" value="FREE" id="del_free" onclick="hideBanban(); delFree();"><label for="del_free">무료</label>
                                                            <input type="radio" name="CD_TYPE" value="PAID" id="del_not_free" onclick="hideBanban()"><label for="del_not_free">유료</label>
                                                            <input type="radio" name="CD_TYPE" value="CONDITION" id="del_banban" onclick="showBanban()"><label for="del_banban">조건부 무료</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">택배사</span>
                                                    </span>
                                                    <input type="text" name="CD_COMPANY" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          배송비/설치비 금액
                                                        </span>
                                                    </span>
                                                    <input type="text" name="CD_FEE" class="form-control text-right" value="0" onkeyup="numCommaKeyUp()">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                    <input type="text" name="CD_FREE" class="form-control cdTypeFreeMax text-right" value="0" onkeyup="numCommaKeyUp()" style="display: none" disabled>
                                                    <span class="input-group-append cdTypeFreeMax" style="display: none">
                                                        <span class="input-group-text w-100 bg-white cdTypeFreeMax">원 이상 구매시 무료 </span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">제주도 및 그 부속도서</span>
                                                    </span>
                                                    <input type="text" name="CD_JEJU" class="form-control text-right" value="0" onkeyup="numCommaKeyUp()">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">도서지방 및 기타 산간지방</span>
                                                    </span>
                                                    <input type="text" name="CD_ETC" class="form-control text-right" value="0" onkeyup="numCommaKeyUp()">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          반품비
                                                        </span>
                                                    </span>
                                                    <input type="text" name="CD_RETURN_FEE" class="form-control text-right" value="0" onkeyup="numCommaKeyUp()">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          배송비 템플릿 기본설정
                                                        </span>
                                                    </span>
                                                    <div class="border p-1 form-control">
                                                        <div class="form-check form-check-inline">
                                                            <input type="checkbox" class="form-check-input" id="dc_li_c2" name="" value="check">
                                                            <label for="dc_li_c2">기본설정</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        </form>
                        <div class="card" style="display: none">
                            <div class="card-body popup-contents mb-4">
                                <fieldset class="mb-0">
                                    <legend>신규등록/수정관리<span class="small"></span></legend>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          출하지명
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-4">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          우편번호
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                    <span class="input-group-append">
                                                        <a class="input-group-text"><i class="icon-map5"></i></a>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-4">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          주소(시,도)
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-4">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          주소(시,군,구)
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          상세주소
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          전화번호
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                          휴대전화
                                                        </span>
                                                    </span>
                                                    <input type="text" name="" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="border p-1">
                                                    <div class="form-check form-check-inline">
                                                        <input type="checkbox" class="form-check-input" id="dc_li_u">
                                                        <label class="form-check-label" for="dc_li_u">도서산간 추가 배송비 설정</label>
                                                    </div>
                                                    <a href="#" class="badge badge-secondary">제주 및 도서산간 해당 지역정보</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">제주도 및 그 부속도서</span>
                                                    </span>
                                                    <input type="text" class="form-control text-right" placeholder="0">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">도서지방 및 기타 산간지방</span>
                                                    </span>
                                                    <input type="text" class="form-control text-right" placeholder="0">
                                                    <span class="input-group-append">
                                                        <span class="input-group-text bg-white ">원</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <div class="border p-1">
                                                    <div class="form-check form-check-inline">
                                                        <input type="checkbox" class="form-check-input" id="dc_li_c" checked>
                                                        <label class="form-check-label" for="dc_li_c">기본설정</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="stock/modal/inModal.html"/>
<!-- 공통 js -->

<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 드래그&드랍 -->
<script th:src="@{/assets/js/plugins/ui/dragula.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>
<!-- 드래그&드랍 -->
<script th:src="@{/assets/js/demo_pages/extension_dnd.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<script>
    $('#companyTable').DataTable({
        buttons: {
            buttons: [
                {
                    text: '새로고침',
                    className: 'btn btn-sm btn-secondary',
                    action: function (e, dt, node, config) {
                        dt.ajax.reload();
                    }
                }
            ]
        },
        dom: '<"datatable-header"Bi><"datatable-scroll"t><"datatable-footer">',
        ordering:false,
        serverSide: true,
        ajax:{
            url:'/company/companyCtType.dataTable?CT_TYPE=STORE',
            type:'post'
        },

        "columns" : [

            {'title':'상호법인명','data':'COM_NAME','defaultContent':'','render':function(data,type,full,meta){
                return '<a class="btn btn-sm badge-indigo" onclick="selectCompany('+meta.row+')">'+data+'</a>'
            }}

        ]


    });

    $('#deliveryTable').DataTable({
        buttons: {
            buttons: [
                {
                    text: '새로고침',
                    className: 'btn btn-sm btn-secondary',
                    action: function (e, dt, node, config) {
                        dt.ajax.reload();
                    }
                }
            ]
        },
        dom: '<"datatable-header"Bi><"datatable-scroll"t><"datatable-footer">',
        ordering:false,
        serverSide: true,
        ajax:{
            url:'/company/companyDelivery.dataTable',
            type:'post'
        },
        "columns" : [
            {'title':'배송비 종류설정','data':'CD_TYPE','defaultContent':''}
            ,{'title':'배송비 금액','data':'CD_FEE','defaultContent':'','render':function (data,type,full,meta){
                return comma(data);
                }}
            ,{'title':'택배사','data':'CD_COMPANY','defaultContent':''}
            ,{'title':'배송비 무료조건 금액','data':'CD_FREE','defaultContent':'','render':function (data,type,full,meta){
                    return comma(data);
                }}
            ,{'title':'제주도 및 그 부속도서 배송비', 'data':'CD_JEJU','defaultContent':'','render':function (data,type,full,meta){
                    return comma(data);
                }}
            ,{'title':'도서산간 배송비', 'data':'CD_ETC','defaultContent':'','render':function (data,type,full,meta){
                    return comma(data);
                }}
            ,{'title':'반품비', 'data':'CD_RETURN_FEE','defaultContent':'','render':function (data,type,full,meta){
                    return comma(data);
                }}
            ,{'title':'배송비 템플릿 기본설정', 'data':'CD_BASIC','defaultContent':'','render':function (data,type,full,meta){
                    if(data==0){
                        return 'N';
                    }else{
                        return 'Y';
                    }
                }}
            ,{'title':'선택', 'data':'CD_IDX','defaultContent':'','render':function (data,type,full,meta){
                    return '<a class="btn btn-sm badge-indigo" onclick="deliveryDetail('+meta.row+')">선택</a>';
                }}
        ]

    });

</script>

<script>
    function selectCompany(rowIdx){
        var dataMap=getDatatablemap('companyTable', rowIdx);
        $('#store_name').html(dataMap.COM_NAME);
        $('#templateForm')[0].reset();
        hideBanban();
        $('#saveTemplateButton').html('저장');
        $('#saveTemplateButton').attr('onclick', 'saveTemplate('+dataMap.COM_IDX+')');
        $('.template').show();
        selectComapnyList(dataMap.COM_IDX);
        $('#del_free').attr('checked',false);
        $('#del_not_free').attr('checked',false);
        $('#del_banban').attr('checked',false);

    }

    function hideBanban(){
        $('.cdTypeFreeMax').hide();
        $('.cdTypeFreeMax').attr('disabled',true);
        $('input[name="CD_FEE"]').removeAttr('readonly');
    }
    function  showBanban(){
        $('input[name="CD_FEE"]').removeAttr('readonly');
        $('.cdTypeFreeMax').removeAttr('disabled');
        $('.cdTypeFreeMax').show();
    }
    function delFree(){
        $('input[name="CD_FEE"]').val(0);
        $('input[name="CD_FEE"]').attr('readonly', true);
    }

    function selectComapnyList(comIdx){
        var table = $('#deliveryTable').DataTable();
        table.ajax.url('/company/companyDelivery.dataTable?COM_IDX='+comIdx).load(null,false);
    }

    function deliveryDetail(rowIdx){
        var dataMap=getDatatablemap('deliveryTable', rowIdx);
        $('#saveTemplateButton').html('수정');
        $('#saveTemplateButton').attr('onclick', 'updateTemplate('+dataMap.CD_IDX+')');
        if(dataMap.CD_TYPE=='FREE'){
            $('#del_not_free').attr('checked',false);
            $('#del_banban').attr('checked',false);
            $('#del_free').attr('checked',true);
            hideBanban();
            delFree();
        }else if (dataMap.CD_TYPE=='PAID'){
            $('#del_free').attr('checked',false);
            $('#del_banban').attr('checked',false);
            $('#del_not_free').attr('checked',true);
            hideBanban();
        }else if(dataMap.CD_TYPE=='CONDITION'){
            $('#del_free').attr('checked',false);
            $('#del_not_free').attr('checked',false);
            $('#del_banban').attr('checked',true);
            showBanban();
        }
        $('input[name="CD_FEE"]').val(comma(dataMap.CD_FEE));
        $('input[name="CD_FREE"]').val(comma(dataMap.CD_FREE));
        $('input[name="CD_JEJU"]').val(comma(dataMap.CD_JEJU));
        $('input[name="CD_ETC"]').val(comma(dataMap.CD_ETC));
        $('input[name="CD_RETURN_FEE"]').val(comma(dataMap.CD_RETURN_FEE));
        $('input[name="CD_COMPANY"]').val(dataMap.CD_COMPANY);
        if(dataMap.CD_BASIC==1){
            $('#dc_li_c2').attr('checked', true);
        }else{
            $('#dc_li_c2').attr('checked', false);
        }
    }

    function saveTemplate(comIdx){
        var check = $('#dc_li_c2').is(':checked');
        var data = '&COM_IDX='+comIdx;
        if(check){
            data+='&CD_BASIC=1';
        }else{
            data+='&CD_BASIC=0';
        }
        var param = $('#templateForm').serialize();
        if(confirm('저장하시겠습니까?')){
            $.ajax({
                url:'/company/companyDeliverySave.ajax',
                type: 'POST',
                data: param+data,
                success:function(res){
                    if(res.message!=null){
                        if(res.message.valueOf('저장되었습니다.')!=-1){
                            $('#templateForm')[0].reset();
                            $('#deliveryTable').DataTable().ajax.reload();
                            $('#dc_li_c2').attr('checked', false);
                            $('#del_free').attr('checked',false);
                            $('#del_not_free').attr('checked',false);
                            $('#del_banban').attr('checked',false);
                        }
                    }
                }
            })
        }
    }

    function updateTemplate(cdIdx){
        var dataMap=getDatatablemap('deliveryTable', 0);
        var check = $('#dc_li_c2').is(':checked');
        var data = '&CD_IDX='+cdIdx;
        if(check){
            data+='&CD_BASIC=1';
        }else{
            data+='&CD_BASIC=0';
        }
        var param = $('#templateForm').serialize();
        if(confirm('수정하시겠습니까?')){
            $.ajax({
                url:'/company/companyDeliveryUpdate.ajax',
                type: 'POST',
                data: param+data,
                success:function(res){
                    if(res.message!=null){
                        if(res.message.valueOf('수정되었습니다.')!=-1){
                            $('#templateForm')[0].reset();
                            $('#deliveryTable').DataTable().ajax.reload();
                            $('#saveTemplateButton').html('저장');
                            $('#saveTemplateButton').attr('onclick', 'saveTemplate('+dataMap.CD_COM_IDX+')');
                            $('#del_free').attr('checked',false);
                            $('#del_not_free').attr('checked',false);
                            $('#del_banban').attr('checked',false);
                            hideBanban();
                            $('#dc_li_c2').attr('checked', false);
                        }
                    }
                }
            })
        }
    }

</script>


</body>



</html>