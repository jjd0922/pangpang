<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>입고등록 > 발주서 상세</title>
    <th:block th:replace="common/css.html"></th:block>
</head>
<body>
<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <div class="page-header page-header-dark">
                <div class="page-header-content container-fluid header-elements-md-inline px-3">
                    <div class="d-flex">
                        <div class="page-title">
                            <h4 class="font-weight-semibold">입고등록 > 발주서 상세</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content area -->
            <div class="content container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body popup-contents mb-4">
                                <!-- 타이틀 -->
                                <fieldset class="mb-0">
                                    <legend class="">1. 입고정보</legend>
                                    <div class="row">
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">입고상태</span>
                                                    </span>
                                                    <input class="form-control" th:value="${ig.igState.option}" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">입고창고<a onclick="openWarehouseModal();" class="badge badge-sm badge-primary ml-1">검색</a></span>
                                                        </span>
                                                    <input type="text" name="whName" class="form-control" placeholder="검색" th:value="${ig?.warehouse?.whName}" readonly>
                                                    <input type="hidden" name="whIdx" th:value="${ig?.warehouse?.whIdx}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">세금계산서 발행일</span>
                                                    </span>
                                                    <input type="text" name="igTaxDate" class="form-control w-datarange daterange-single" placeholder="입력" th:value="${ig?.igTaxDate}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">입고담당자<a onclick="showUserModal();" class="badge badge-sm badge-primary ml-1">검색</a></span>
                                                        </span>
                                                    <input type="text" name="uName" class="form-control" placeholder="검색" th:value="${ig?.user?.uName}" readonly>
                                                    <input type="hidden" name="uIdx" th:value="${ig?.user?.uIdx}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">입고완료일</span>
                                                    </span>
                                                    <input type="text" name="igDate" class="form-control w-datarange daterange-single" placeholder="입력" th:value="${ig?.igDate}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">입고 메모</span>
                                                    </span>
                                                    <input type="text" name="igMemo" class="form-control" placeholder="입력" th:value="${ig?.igMemo}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">강제입고 사유</span>
                                                    </span>
                                                    <input type="text" name="igDoneMemo" class="form-control" placeholder="입력" th:value="${ig?.igDoneMemo}">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="card-body popup-contents mb-4">
                                <fieldset class="mb-0">
                                    <legend class="">
                                        2. 상품 입고 정보
                                    </legend>

                                    <div class="row">
                                        <table class="table" id="inProductTable">
                                        </table>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="card-body popup-contents mb-4">
                                <fieldset class="mb-0">
                                    <legend class="">
                                        3. 발주 상품정보
                                    </legend>

                                    <div class="row">
                                        <table class="table" id="inPoProductTable">
                                        </table>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="card-body popup-contents mb-4">
                                <fieldset class="mb-0">
                                    <legend class="">
                                        발주 정보
                                    </legend>

                                    <div class="row">
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">발주상태</span>
                                                    </span>
                                                    <select class="form-control select">
                                                        <option th:each="opt : ${T(com.newper.constant.PoState).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${po?.poState} == ${opt.name()}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">발주예정창고</span>
                                                    </span>
                                                    <input type="text" class="form-control" placeholder="검색" th:value="${po?.warehouse?.whName}" readonly>
                                                </div>
                                            </div>
                                        </div>



                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">발주담당자</span>
                                                    </span>
                                                    <input type="text" class="form-control" placeholder="입력" th:value="${po?.hiworks?.hwAprvId}" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">발주완료일</span>
                                                    </span>
                                                    <input type="text" class="form-control" placeholder="입력" th:value="${po?.hiworks?.hwAprvDate}" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">거래처 담당자</span>
                                                    </span>
                                                    <input type="text" class="form-control" placeholder="입력" th:value="${po?.hiworks?.user?.uName}" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">발주메모</span>
                                                    </span>
                                                    <input type="text" name="igTaxDate" class="form-control w-datarange daterange-single" placeholder="입력" th:value="${po?.poMemo}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">첨부파일<a th:if="${po != null}" th:href="|javascript: fileDownload('${po?.poFile}', '${po?.poFileName}')|" class="badge badge-sm badge-primary ml-1">다운로드</a></span>
                                                        </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">입고 메모</span>
                                                    </span>
                                                    <input type="text" name="igMemo" class="form-control" placeholder="입력" th:value="${ig?.igMemo}">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /content area -->

        </div>
        <!-- /inner content -->

        <!-- Footer -->
        <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
            <button type="button" class="btn btn-sm btn-light float-left" onclick="window.close();"><i class="icon-cross2 mr-1"></i>닫기</button>
            <div>
                <button type="button" class="btn btn-sm btn-secondary ml-1" onclick="productComp();">자산수령</button>
                <button type="button" class="btn btn-sm btn-secondary ml-1" onclick="inComp('normal');">입고완료</button>
                <button type="button" class="btn btn-sm btn-secondary ml-1" onclick="inComp('compulsion');">강제 입고완료</button>
            </div>
        </div>
        <!-- /footer -->
    </div>
</div>

<!-- 공통 js -->

<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/ui/moment/moment.min.js}"></script>
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>
<script th:src="@{/assets/js/plugins/pickers/daterangepicker.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>
<script th:src="@{/assets/js/demo_pages/picker_date.js}"></script>

<!-- 멀티 선택 (숫자) -->
<script th:src="@{/assets/js/plugins/forms/selects/bootstrap_multiselect.js}"></script>
<script th:src="@{/assets/js/demo_pages/form_multiselect.js}"></script>

<script th:src="@{/assets/js/autocomplete/autocomplete-jquery-ui.min.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<th:block th:replace="in/modal/inModal.html"></th:block>
<th:block th:replace="goods/modal/warehouseModal.html"/>
<th:block th:replace="modal/userModal.html"/>

<script>
    function productComp () {
        $.ajax({
            url: '/in/[[${poIdx}]]/poComp.ajax',
            processData: false,
            contentType: false,
            type: 'post',
            data: new FormData($('#createForm')[0])
        });
    }

    function inComp (flag) {
        if (flag == 'normal') {
            $.ajax({
                url: '/in/inGroupSave.ajax',
                processData: false,
                contentType: false,
                type: 'post',
                data: new FormData($('#createForm')[0])
            });
        } else {
            if ($('input[name=igDoneMemo]') == '') {
                alert ('강제 입고 사유를 입력해 주세요.');
                return false;
            }

            $.ajax({
                url: '/in/po/compulsion.ajax',
                processData: false,
                contentType: false,
                type: 'post',
                data: new FormData($('#createForm')[0])
            });
        }
    }

    function selectUser(row) {
        var rowData = getDatatablemap('userModalTable', row);

        $('#searchUserModal').modal('hide');
        $('#regiForm input[name="uName"]').val(rowData.U_NAME);
        $('input[name="uIdx"]').val(rowData.U_IDX);
    }
</script>
<script th:inline="javascript">
    //입고 정보 table
    var inProductTable = $('#inProductTable').DataTable({
        ordering:false,
        serverSide: false,
        ajax:{
            url:'/in/poProduct.dataTable?po_idx=[[${poIdx}]]',
            type:'post'
        },
        pageLength: -1,
        dom: '<"datatable-header"B><"datatable-scroll"t><"datatable-footer">',
        buttons: [
            {
                text: '자산코드 엑셀 업로드',
                className: 'btn btn-sm btn-primary',
                action: function (e, dt, node, config) {
                    openInExcelModal();
                }
            }
            ,{
                text: '새로고침',
                className: 'btn btn-sm btn-secondary',
                action: function (e, dt, node, config) {
                    dt.ajax.reload();
                }
            }
        ],
        "columns" : [
            {'title':'No','data':'No','render':function(data,type,full,meta){
                    return meta.settings._iDisplayStart+meta.row+1;
                }}
            ,{'title':'상품코드','data':'P_IDX'}
            ,{'title':'상품명','data':'P_NAME'}
            ,{'title':'모델명','data':'P_MODEL'}
            ,{'title':'매입수량','data':'PP_COUNT', 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'입고 수량','data':'IP_COUNT', 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'자산코드','data':'','render':function(data,type,full,meta){
                return '<a class="btn btn-sm badge-indigo" onclick="openInModal('+meta.row+')">등록</a>';
            }}
        ]
    });

    //발주상품정보
    var inPoProductTable = $('#inPoProductTable').DataTable({
        ordering:false,
        serverSide: false,
        ajax:{
            url:'/in/po.dataTable?po_idx=[[${poIdx}]]',
            type:'post'
        },
        pageLength: -1,
        dom: '<"datatable-header"><"datatable-scroll"t><"datatable-footer">',
        buttons: [
            {
                text: '새로고침',
                className: 'btn btn-sm btn-secondary',
                action: function (e, dt, node, config) {
                    dt.ajax.reload();
                }
            }
        ],
        "columns" : [
            {'title':'No','data':'No','render':function(data,type,full,meta){
                return meta.settings._iDisplayStart+meta.row+1;
            }}
            ,{'title':'상품코드','data':'P_IDX'}
            ,{'title':'상품명','data':'P_NAME'}
            ,{'title':'옵션','data':'PP_OPTION'}
            ,{'title':'기준 매입가','data':'P_SELL_PRICE', 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'구매단가','data':'PP_COST', 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'매입수량','data':'PP_COUNT', 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'매입총액','data':'PP_TOTAL' , 'class':'text-right','render':function(data,type,full,meta){
                return comma(data);
            }}
            ,{'title':'입고 SPEC(예정)','data':'buy_spec','defaultContent':''}
            ,{'title':'판매 SPEC(예정)','data':'sell_spec','defaultContent':''}
        ]
    });
</script>
</body>
</html>
