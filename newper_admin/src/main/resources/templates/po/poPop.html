<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${po != null ? '발주품의 상세/수정' : '발주품의 신규 등록'}"></title>
    <th:block th:replace="common/css.html"></th:block>
</head>
<body>
<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <div class="page-header page-header-dark">
                <div class="page-header-content container-fluid header-elements-md-inline px-3">
                    <div class="d-flex">
                        <div class="page-title">
                            <h4 class="font-weight-semibold" th:text="${po != null ? '발주품의 상세' : '발주품의 신규 등록'}"><i class="icon-office mr-1"></i></h4>

                        </div>
                    </div>
                </div>
            </div>


            <!-- Content area -->
            <div class="content container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <form id="createForm">
                            <div class="card">
                                <div class="card-body popup-contents">
                                    <!-- 타이틀 -->
                                    <fieldset class="mb-0">
                                        <legend class="">1. 등록 정보</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">발주코드</span>
                                                        </span>
                                                        <input type="text" name="poIdx" class="form-control" th:value="${po?.poIdx}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의작성자(등록자)</span>
                                                        </span>
                                                        <input type="text" name="createdBy" class="form-control" th:value="${po != null ? po?.createdBy: @sessionInfo.id}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의작성일(등록일)</span>
                                                        </span>
                                                        <input type="text" name="createdDate" class="form-control" th:value="${po != null ? po?.createdDate : #calendars.format(#calendars.createNow(),'yyyy-MM-dd')}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의요청일</span>
                                                        </span>
                                                        <input type="text" name="poRequestDate" class="form-control" th:value="${po?.poRequestDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">구매담당자<a onclick="showUserModal();" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="uName" class="form-control" readonly>
                                                        <input type="hidden" name="uIdx">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의상태</span>
                                                        </span>
                                                        <input name="poState" class="form-control" readonly th:value="${po?.poState?.option}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의 승인/반려자</span>
                                                        </span>
                                                        <input type="text" name="hwAprvId" class="form-control" th:value="${po?.hiworks?.hwAprvId}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의 승인/반려일</span>
                                                        </span>
                                                        <input type="text" name="hwAprvDate" class="form-control" th:value="${po?.hiworks?.hwAprvDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">첨부파일<a th:if="${po != null}" th:href="|javascript: fileDownload('${po?.poFile}', '${po?.poFileName}')|" class="badge badge-sm badge-primary ml-1">다운로드</a></span>
                                                        </span>
                                                        <input type="file" name="poFile" class="form-control form-control-plaintext" placeholder="파일첨부">
                                                        <input type="hidden" name="poFileOri" th:if="${po != null}" th:value="${po?.poFile}">
                                                        <input type="hidden" name="poFileNameOri"  th:if="${po != null}" th:value="${po?.poFileName}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">긴급발주</span>
                                                        </span>
                                                        <select name="poType" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.PoType).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${#strings.toString(po?.poType) eq opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의메모</span>
                                                        </span>
                                                        <input type="text" name="poMemo" class="form-control" th:value="${po?.poMemo}">
                                                    </div>
                                                </div>
                                            </div>


                                        </div>

                                        <legend class="mt-3">2. 구매개요</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">매입처<a onclick="openCompanyModal_flag('PURCHASE');" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="comNameBuy" class="form-control" th:value="${po?.company?.comName}" readonly>
                                                        <input type="hidden" name="comIdxBuy" th:value="${po?.company?.comIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">채널유형</span>
                                                        </span>
                                                        <select name="poBuyChannel" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.Channel).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${po != null} and ${po?.poBuyChannel} == ${opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미수대금</span>
                                                        </span>
                                                        <input type="text" name="poBuyReceiveAmount" class="form-control" th:value="${po?.poBuyReceiveAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미지급대금</span>
                                                        </span>
                                                        <input type="text" name="poBuyUnpaidAmount" class="form-control" th:value="${po?.poBuyUnpaidAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">총구매액</span>
                                                        </span>
                                                        <input type="text" name="poTotalAmount" class="form-control" th:value="${po?.poTotalAmount}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">원사용처</span>
                                                        </span>
                                                        <input type="text" name="poBuyOriUse" class="form-control"th:value="${po?.poBuyOriUse}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">제품상태(품목구분1)</span>
                                                        </span>
                                                        <select name="poBuyProductType" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.PType1).values()}" th:text="${opt.option}" th:value="${opt.name()}" th:selected="${po != null} and ${po?.poBuyProductType} == ${opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">판매기한</span>
                                                        </span>
                                                        <input type="text" name="poBuySellPeriod" class="form-control w-datarange daterange-basic-form" th:value="${po?.poBuySellPeriod}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="pt-3">3. 판매개요</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">판매처<a href="javascript: openCompanyModal_flag('SELL');" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="comNameSell" class="form-control" th:value="${po?.companySell?.comIdx}" readonly>
                                                        <input type="hidden" name="comIdxSell" th:value="${po?.companySell?.comIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">채널유형</span>
                                                        </span>
                                                        <select name="poSellChannel" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.Channel).values()}" th:text="${opt.option}" th:value="${opt.name()}" th:selected="${po != null} and ${po?.poSellChannel} == ${opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미수대금</span>
                                                        </span>
                                                        <input type="text" name="poSellReceiveAmount" class="form-control" th:value="${po?.poSellReceiveAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미지급대금</span>
                                                        </span>
                                                        <input type="text" name="poUnpaidAmount" class="form-control" th:value="${po?.poSellUnpaidAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">총판매액</span>
                                                        </span>
                                                        <input type="text" name="poSellTotalAmount" class="form-control" th:value="${po?.poSellTotalAmount}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">대금지급일</span>
                                                        </span>
                                                        <input type="text" name="poSellPayDate" class="form-control w-datarange daterange-single" th:value="${po?.poSellPayDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">예상수익률</span>
                                                        </span>
                                                        <input type="text" name="poSellProfit" class="form-control" th:value="${po?.poSellProfit}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">사용용도</span>
                                                        </span>
                                                        <input type="text" name="poSellUse" class="form-control" th:value="${po?.poSellUse}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="mt-3">4. 계약조건</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">입고예정일</span>
                                                        </span>
                                                        <input type="text" name="poInDate" class="form-control w-datarange daterange-single" th:value="${po?.poInDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">납기일</span>
                                                        </span>
                                                        <input type="text" name="poDueDate" class="form-control w-datarange daterange-single" th:value="${po?.poDueDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">반품기한</span>
                                                        </span>
                                                        <input type="text" name="poRefundDate" class="form-control w-datarange daterange-single" th:value="${po?.poRefundDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">A/S기한</span>
                                                        </span>
                                                        <input type="text" name="poAsDate" class="form-control w-datarange daterange-single" th:value="${po?.poAsDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">재매입</span>
                                                        </span>
                                                        <select name="poRepurchase" class="form-control select">
                                                            <option value="false">N</option>
                                                            <option value="true" th:selected="${po?.poRepurchase == 'Y'}">Y</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested d-flex justify-content-between">입고예정창고<a href="javascript:openWarehouseModal();" class="badge badge-sm badge-primary ml-1">검색</a></span>
                                                        </span>
                                                        <input type="text" name="whName" class="form-control" th:value="${po?.warehouse?.whName}" readonly>
                                                        <input type="hidden" name="whIdx" th:value="${po?.warehouse?.whIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">매입운송비 주체</span>
                                                        </span>
                                                        <input type="text" name="poDeliveryMain" class="form-control" th:value="${po?.poDeliveryMain}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">매입운송비</span>
                                                        </span>
                                                        <input type="text" name="poDeliveryCost" class="form-control" th:value="${po?.poDeliveryCost}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">계산서발행월</span>
                                                        </span>
                                                        <input type="text" name="poTaxMonth" class="form-control w-datarange daterange-single" th:value="${po?.poTaxMonth}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">지급예정일</span>
                                                        </span>
                                                        <input type="text" name="poPayDate" class="form-control w-datarange daterange-single" th:value="${po?.poPayDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">입금계좌정보</span>
                                                        </span>
                                                        <input type="text" name="poPayAccount" class="form-control" th:value="${po?.poPayAccount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">계약정보<a onclick="openContractModal();" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="ccName" class="form-control" th:value="${po?.contract?.ccName}" readonly>
                                                        <input type="hidden" name="ccIdx" th:value="${po?.contract?.ccIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">정산방식</span>
                                                        </span>
                                                        <input type="text" name="ccCalType" class="form-control" th:value="${po?.contract?.ccCalType}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">정산주기</span>
                                                        </span>
                                                        <input type="text" name="ccCycle" class="form-control" th:value="${po?.contract?.ccCycle}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">계약번호</span>
                                                        </span>
                                                        <input type="text" name="ccNum" class="form-control" th:value="${po?.contract?.ccNum}" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="mt-3">5. 상품정보
                                            <a onclick="openProductModal()" class="btn btn-sm btn-primary ml-1">검색</a>
                                        </legend>
                                        <div class="row overflow-x-scroll">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>상품코드</th>
                                                        <th>상품명</th>
                                                        <th>외부상품코드</th>
                                                        <th>브랜드</th>
                                                        <th>옵션1</th>
                                                        <th>옵션2</th>
                                                        <th>옵션3</th>
                                                        <th>기준매입가</th>
                                                        <th>구매단가<br>(실매입가)</th>
                                                        <th>매입수량</th>
                                                        <th>매입총액</th>
                                                        <th>목표수익률</th>
                                                        <th>입고SPEC(예정)</th>
                                                        <th>판매SPEC(예정)</th>
                                                        <th>삭제</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="productTbody">
                                                    <tr class="defaultRow" th:unless="${poProduct != null}">
                                                        <td colspan="15">
                                                            발주품의할 상품을 선택하십시오.
                                                            <input type="hidden" name="cnt">
                                                        </td>
                                                    </tr>
                                                    <tr th:if="${poProduct != null}" th:each="i : ${poProduct}"><!--th:class="|productPoTr_${iStat.index} poProductTr|"-->
                                                        <td th:text="${i.P_IDX}"></td>
                                                        <td th:text="${i.P_NAME}"></td>
                                                        <td th:text="${i.PP_MEMO}"></td>
                                                        <td th:text="${i.CATE_NAME}"></td>
                                                        <td th:text="${i.OPTION1}"></td>
                                                        <td th:text="${i.OPTION2}"></td>
                                                        <td th:text="${i.OPTION3}"></td>
                                                        <td th:text="${i.P_COST}"></td>
                                                        <td th:text="${i.PP_COST}"></td>
                                                        <td th:text="${i.PP_COUNT}"></td>
                                                        <td th:text="${i.PP_COST * i.PP_COUNT}"></td>
                                                        <td th:text="${i.PP_PROFIT_TARGET}"></td>
                                                        <td th:text="${i.SPEC_BUY}"></td>
                                                        <td th:text="${i.SPEC_SELL}"></td>
                                                        <td><a onclick="deleteRow($(this))" class="btn btn-sm btn-warning">삭제</a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <legend class="mt-3">6. 수익률</legend>
                                        <div class="row overflow-x-scroll">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>상품코드</th>
                                                        <th>상품명</th>
                                                        <th>예상수리항목</th>
                                                        <th>예상수리비</th>
                                                        <th>예상도색항목</th>
                                                        <th>예상도색비</th>
                                                        <th>예상가공항목</th>
                                                        <th>예상가공비용</th>
                                                        <th>생산원가합</th>
                                                        <th>생산원가율</th>
                                                        <th>구매단가</th>
                                                        <th>구매단가 총액</th>
                                                        <th>예상판매가</th>
                                                        <th>예상판매가총액</th>
                                                        <th>총이익</th>
                                                        <th>수익률</th>
                                                        <th>목표수익률</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="rateTbody">
                                                    <tr class="defaultRow" th:unless="${poProduct != null}">
                                                        <td colspan="18">발주품의할 상품을 선택하십시오.</td>
                                                    </tr>
                                                    <tr th:if="${poProduct != null}" th:each="i : ${poProduct}" th:id="|tr_${iStat.index}|" th:class="|productPoTr_${iStat.index}|">
                                                        <td th:text="${i.P_IDX}"></td>
                                                        <td th:text="${i.P_NAME}"></td>
                                                        <td th:text="${i.PP_FIX_MEMO}"></td>
                                                        <td th:text="${i.PP_FIX_COST}"></td>
                                                        <td th:text="${i.PP_PAINT_MEMO}"></td>
                                                        <td th:text="${i.PP_PAINT_COST}"></td>
                                                        <td th:text="${i.PP_PROCESS_MEMO}"></td>
                                                        <td th:text="${i.PP_PROCESS_COST}"></td>
                                                        <td th:text="${(i.PP_PAINT_COST + i.PP_FIX_COST + i.PP_PROCESS_COST) * i.PP_COUNT}"></td>
                                                        <td th:id="|buy_per_${iStat.index}|"></td>
                                                        <td th:text="${i.PP_COST}"></td>
                                                        <td th:text="${i.PP_COST * i.PP_COUNT}"></td>
                                                        <td th:text="${i.PP_SELL_PRICE}"></td>
                                                        <td th:id="|poProductSellPriceTotal_${iStat.index}|" th:text="${i.PP_SELL_PRICE * i.PP_COUNT}"></td>
                                                        <td th:id="|totalProfit_${iStat.index}|"></td>
                                                        <td th:id="|profitPer_${iStat.index}|"></td>
                                                        <td th:text="${i.PP_PROFIT_TARGET}"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </fieldset>
                                    <!-- 타이틀 구분 끝-->
                                </div>
                            </div>
                        </form>
                        <!-- #regiForm end -->
                    </div>
                </div>
            </div>
            <!-- /content area -->

        </div>
        <!-- /inner content -->

        <!-- Footer -->
        <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
            <button type="button" class="btn btn-sm btn-light float-left" onclick="window.close();"><i class="icon-cross2 mr-1"></i>닫기</button>
            <button th:if="${po?.hiworks == null}" type="button" class="btn btn-sm btn-secondary ml-1" id="saveBtn"><i class="icon-floppy-disk mr-1"></i>저장</button>
        </div>
        <!-- /footer -->
    </div>
</div>
<!-- 공통 js -->
<script th:src="@{/assets/js/main/jquery.min.js}"></script>
<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/ui/moment/moment.min.js}"></script>
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>
<script th:src="@{/assets/js/plugins/pickers/daterangepicker.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>
<script th:src="@{/assets/js/demo_pages/picker_date.js}"></script>

<!-- 멀티 선택 (숫자) -->
<script th:src="@{/assets/js/plugins/forms/selects/bootstrap_multiselect.js}"></script>
<script th:src="@{/assets/js/demo_pages/form_multiselect.js}"></script>

<script th:src="@{/assets/js/autocomplete/autocomplete-jquery-ui.min.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<th:block th:replace="company/modal/companyModal.html"/>
<th:block th:replace="product/modal/productModal_po.html"/>
<th:block th:replace="goods/modal/warehouseModal.html"/>
<th:block th:replace="company/modal/contractModal.html"/>
<th:block th:replace="modal/userModal.html"/>


<script>
    function selectUser(row) {
        var rowData = getDatatablemap('userModalTable', row);

        $('#searchUserModal').modal('hide');
        $('input[name=uName]').val(rowData.U_NAME);
        $('input[name=uIdx]').val(rowData.U_IDX);
    }

    function saveAction(){
        /*if ($('hidden[name=comIdx_buy]').val() == '') {
            alert('매입처를 선택해 주세요.');
            return false;
        }

        if ($('hidden[name=uIdx]').val() == '') {
            alert('구매담당자를 선택해 주세요.');
            return false;
        }

        if ($('hidden[name=ccIdx]').val() == '') {
            alert('계약서를 선택해 주세요.');
            return false;
        }

        if ($('input[name=whIdx]').val() == '') {
            alert('입고예정창고를 선택해 주세요.');
            return false;
        }

        if ($('input[name=poProductCost]').length == 0) {
            alert('상품을 추가해주세요');
            return false;
        }*/

        var poTotalAmount = $('input[name=poTotalAmount]').val().replace(/,/gi,'');
        $('input[name=poTotalAmount]').val(poTotalAmount);

        var poSellTotalAmount = $('input[name=poSellTotalAmount]').val().replace(/,/gi,'');
        $('input[name=poSellTotalAmount]').val(poSellTotalAmount);

        $.ajax({
            url: location.pathname + '.ajax',
            processData: false,
            contentType: false,
            type: 'post',
            data: new FormData($('#createForm')[0])
        });
    }


    // 거래처 검색 선택
    var companyFlag = '';
    function openCompanyModal_flag (flag) {
        companyFlag = flag;
        $('#companyModalType').hide();
        $('#companyModalForm select[name=ctType]').val(flag);
        openCompanyModal();
    }

    function companySelect(row){
        var rowData = $('#companyModalTable').DataTable().rows(row).data()[0];

        if (companyFlag == 'PURCHASE') {
            $('input[name=uName]').val(rowData.U_NAME);
            $('input[name=uIdx]').val(rowData.U_IDX);
            $('input[name=comIdxBuy]').val(rowData.COM_IDX);
            $('input[name=comNameBuy]').val(rowData.COM_NAME);
        } else {
            $('input[name=comIdxSell]').val(rowData.COM_IDX);
            $('input[name=comNameSell]').val(rowData.COM_NAME);
        }
        $('#companyModal').modal('hide');
    }

    //거래처 모달에서 선택
    function contractSelect(row){
        var rowData = $('#contractModalTable').DataTable().rows(row).data()[0];

        $('input[name=ccIdx]').val(rowData.CC_IDX);
        $('input[name=ccName]').val(rowData.CC_NAME);
        $('input[name=ccType]').val(rowData.CC_TYPE_STR);
        $('input[name=ccCycle]').val(rowData.CC_CYCLE_STR);
        $('input[name=ccNum]').val(rowData.CC_NUM);
        $('#contractModal').modal('hide');
    }

    /** 테이블 행 삭제*/
    function deleteRow(el) {
        var target = el.closest('tr');
        var rowIdx = target.index();
        target.remove();
        $('#rateTbody tr')[rowIdx].remove();

        // 기본행 보여주기
        if ($('#rateTbody tr').length < 2) {
            $('.defaultRow').attr('hidden', false);
        }
    }

    var cnt = 0;
    /** product테이블 새로운 행 더하기*/
    function appendRowToProductTable(data) {
        var brandName = '';
        if (data.BRAND_NAME != null && data.BRAND_NAME != '') {
            brandName = data.BRAND_NAME;
        }
        // product테이블 행추가
        $('#productTbody').append(
            '<tr>' +
            '   <td><input type="hidden" name="pIdx_'+cnt+'" value="'+data.P_IDX+'">'+data.P_IDX+'</td>' +
            '   <td>'+data.P_NAME+'</td>' +
            '   <td><input type="text" name="ppMemo_'+cnt+'" class="form-control"></td>' +
            '   <td>'+brandName+'</td>' +
            '   <td id="ppOption1_'+cnt+'"></td>' +
            '   <td id="ppOption2_'+cnt+'"></td>' +
            '   <td id="ppOption3_'+cnt+'"></td>' +
            '   <td>'+data.P_COST+'</td>' +
            '   <td><input type="text" name="ppCost_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppCount_'+cnt+'" class="form-control"></td>' +
            '   <td id="ppCostAll_'+cnt+'"></td>' + // 매입총액
            '   <td><input type="text" name="ppProfitTarget_'+cnt+'" class="form-control"></td>' +
            '   <td id="poBuySpec_'+cnt+'"></td>' +
            '   <td id="poSellSpec_'+cnt+'"></td>' +
            '   <td><a href="#" onclick="deleteRow($(this))" class="badge badge-warning">삭제</a></td>' +
            '</tr>'
        );

        //option selectBox 추가
        var options = JSON.parse(data.P_OPTION);
        for (var i = 0; i < options.length; i++) {
            var selectName = 'ppOption'+(i+1)+'_'+cnt;
            $('#'+selectName).append(
                '<select name="'+selectName+'" class="form-control"></select>'
            );

            var optVal = options[i].values;
            for (var ov of optVal) {
                $('select[name="'+selectName+'"]').append(
                    '<option value="'+ov+'">'+ov+'</option>'
                );
            }
        }

        // spec input 추가
        var cateSpecList = data.CATE_SPEC_LIST;
        if (cateSpecList != null && cateSpecList != '') {
            var specList = JSON.parse(data.CATE_SPEC_LIST);
            for (var i = 0; i < specList.length; i++) {
                $('#poBuySpec_'+cnt).append(
                    '<div class="d-flex">' +
                    '   <input type="text" name="speclName_'+cnt+'" class="form-control mb--1 mr--1 w-50" value="'+specList[i]+'" readonly tabindex="-1">' +
                    '   <input type="text" name="speclValue_'+cnt+'" class="form-control mb--1 w-70">' +
                    '</div>'
                );
                $('#poSellSpec_'+cnt).append(
                    '<div class="d-flex">' +
                    '   <input type="text" name="speclName_'+cnt+'" class="form-control mb--1 mr--1 w-50" value="'+specList[i]+'" readonly tabindex="-1">' +
                    '   <input type="text" name="speclValue_'+cnt+'" class="form-control mb--1 w-70">' +
                    '</div>'
                );
            }
        }

        // spec input auto complete
        var specListTd = $('.specListTd');
        for (var i = 0; i < specListTd.length; i++) {
            $.ajax({
                type: "GET",
                url:"/goods/specList.ajax?specName=" + specListTd[i].innerHTML,
                async:false,
                success : function(result){
                    $('input[specList='+i+']').autocomplete({
                        source: result
                        ,minLength: 0
                    });
                }
            });
        }

        // 수익률테이블 행추가
        $('#rateTbody').append(
            '<tr>' +
            '   <td>'+data.P_IDX+'</td>' +
            '   <td>'+data.P_NAME+'</td>' +
            '   <td><input type="text" name="ppFixMemo_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppFixCost_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppPaintMemo_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppPaintCost_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppProcessMemo_'+cnt+'" class="form-control"></td>' +
            '   <td><input type="text" name="ppProcessCost_'+cnt+'" class="form-control"></td>' +
            '</tr>'
        );

        cnt++;
        $('input[name="cnt"]').val(cnt);
    }
</script>
<script>
    $("#saveBtn").on("click", saveAction);

    function openContractModal() {
        var comIdx = $('input[name=comIdxBuy]').val();
        if (comIdx == '') {
            alert('매입처를 선택해 주세요.');
            return false;
        }

        $('#contractModalComIdx').val(comIdx);
        $('#contractModal').modal('show');
        selectContractDataTable();
    }
</script>
<script th:if="${poProduct != null}" th:each="i : ${poProduct}">
    $(function () {
        priceSetting([[${iStat.index}]]);
    });
</script>
</body>
</html>
