<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${po != null ? '발주품의 상세/수정' : '발주품의 신규 등록'}"></title>
    <th:block th:replace="common/css.html"></th:block>
    <style>
        .w-200 {
            width: 200px!important;
        }
        .w-7 {
            width: 7%!important;
        }
    </style>
</head>
<body>
<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <div class="page-header page-header-dark">
                <div class="page-header-content container-fluid header-elements-md-inline px-3">
                    <div class="d-flex">
                        <div class="page-title">
                            <h4 class="font-weight-semibold" th:text="${po != null ? '발주품의 상세' : '발주품의 신규 등록'}"><i class="icon-office mr-1"></i></h4>

                        </div>
                    </div>
                </div>
            </div>


            <!-- Content area -->
            <div class="content container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <form id="createForm">
                            <div class="card">
                                <div class="card-body popup-contents">
                                    <!-- 타이틀 -->
                                    <fieldset class="mb-0">
                                        <legend>1. 등록 정보</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">발주코드</span>
                                                        </span>
                                                        <input type="text" name="poIdx" class="form-control" th:value="${po?.poIdx}" readonly>
                                                        <input type="hidden" name="poBuyProductType" value="NORMAL">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의작성자(등록자)</span>
                                                        </span>
                                                        <input type="text" name="createdBy" class="form-control" th:value="${po != null ? po?.createdBy: @sessionInfo.id}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의작성일(등록일)</span>
                                                        </span>
                                                        <input type="text" name="createdDate" class="form-control" th:value="${po != null ? po?.createdDate : #calendars.format(#calendars.createNow(),'yyyy-MM-dd')}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의요청일</span>
                                                        </span>
                                                        <input type="text" name="poRequestDate" class="form-control" th:value="${po?.poRequestDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">첨부파일<a th:if="${po != null && po?.poFile != ''}" th:title="${po?.poFileName}" th:href="|javascript: fileDownload('${po?.poFile}', '${po?.poFileName}')|" class="badge badge-sm badge-primary ml-1">다운로드</a></span>
                                                        </span>
                                                        <input type="file" name="poFile" class="form-control form-control-plaintext" placeholder="파일첨부">
                                                        <input type="hidden" name="poFileOri" th:if="${po != null}" th:value="${po?.poFile}">
                                                        <input type="hidden" name="poFileNameOri"  th:if="${po != null}" th:value="${po?.poFileName}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">긴급발주</span>
                                                        </span>
                                                        <select name="poType" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.PoType).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${#strings.toString(po?.poType) eq opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">구매담당자</span>
                                                        </span>
                                                        <input type="text" name="uName" class="form-control" readonly>
                                                        <input type="hidden" name="uIdx">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의상태</span>
                                                        </span>
                                                        <input name="poState" class="form-control" readonly th:value="${po?.poState?.option}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">품의메모</span>
                                                        </span>
                                                        <input type="text" name="poMemo" class="form-control" th:value="${po?.poMemo}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!--<legend class="mt-3">
                                            2. 품의경로<a class="btn btn-sm btn-primary ml-2" onclick="showUserModal()">추가</a>
                                        </legend>
                                        <select name="hwType" class="form-control select2-hidden-accessible">
                                            <option th:each="opt: ${T(com.newper.constant.HwType).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}"></option>
                                        </select>
                                        <input type="hidden" name="hwCnt" th:value="${poHiworks != null} ? ${poHiworks.size()}">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <td>NO</td>
                                                    <td>담당자</td>
                                                    <td>구분</td>
                                                    <td>메모</td>
                                                    <td>결과</td>
                                                    <td>승인메모</td>
                                                    <td>처리일</td>
                                                    <td>삭제</td>
                                                </tr>
                                            </thead>
                                            <tbody id="courseTbody">
                                                <tr id="courseDefault" th:unless="${poHiworks != null}">
                                                    <td colspan="8">품의경로를 입력하십시오</td>
                                                </tr>
                                                <tr th:if="${poHiworks != null}" th:each="poh: ${poHiworks}" th:with="hw=${@hiworksRepo.findById(poh.POH_HW_IDX).get()}">
                                                    <td class="dragula-handle course-no">
                                                        <i class="icon-menu-open"></i><span>${poh.POH_ORDER}+1</span>
                                                        <input type="hidden" th:name="|order_${poh.POH_ORDER}|" th:value="${poh.POH_ORDER}">
                                                    </td>
                                                    <td><input type="hidden" th:name="|hwAprvId_${poh.POH_ORDER}|" th:value="${hw.hwAprvId}">${hw.hwAprvId}</td>
                                                    <td><input type="hidden" th:name="|hwType_${poh.POH_ORDER}|" th:value="${hw.hwType.name()}">${hw.hwType.getOption()}</td>
                                                    <td><input type="hidden" th:name="|hwMemo_${poh.POH_ORDER}|" th:value="${hw.hwMemo}">${hw.hwMemo}</td>
                                                    <td th:text="${hw.hwState.getOption()}">결과</td>
                                                    <td>승인메모</td>
                                                    <td th:text="${hw.hwAprvDate}">처리일</td>
                                                    <td><a onclick="deleteCourse($(this))" class="btn btn-sm btn-warning">삭제</a></td>
                                                </tr>
                                            </tbody>
                                        </table>-->

                                        <legend class="mt-3">3. 구매개요</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested d-flex justify-content-between">매입처<a onclick="openCompanyModal_flag('PURCHASE');" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="comNameBuy" class="form-control" th:value="${po?.company?.comName}" readonly>
                                                        <input type="hidden" name="comIdxBuy" th:value="${po?.company?.comIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">채널유형</span>
                                                        </span>
                                                        <select name="poBuyChannel" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.Channel).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${po != null} and ${po?.poBuyChannel} == ${opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미수대금</span>
                                                        </span>
                                                        <input type="text" name="poBuyReceiveAmount" class="form-control text-right" th:value="${po?.poBuyReceiveAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미지급대금</span>
                                                        </span>
                                                        <input type="text" name="poBuyUnpaidAmount" class="form-control text-right" th:value="${po?.poBuyUnpaidAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">총구매액</span>
                                                        </span>
                                                        <input type="text" name="poTotalAmount" class="form-control text-right" th:value="${#numbers.formatInteger(po?.poTotalAmount,1,'COMMA')}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">원사용처</span>
                                                        </span>
                                                        <input type="text" name="poBuyOriUse" class="form-control"th:value="${po?.poBuyOriUse}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">판매기한</span>
                                                        </span>
                                                        <input type="text" name="poBuySellPeriod" class="form-control w-datarange daterange-basic-form" th:value="${po?.poBuySellPeriod}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="pt-3">4. 판매개요</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested d-flex justify-content-between">판매처<a href="javascript: openCompanyModal_flag('SELL');" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="comNameSell" class="form-control" th:value="${po?.company_sell?.comIdx}" readonly>
                                                        <input type="hidden" name="comIdxSell" th:value="${po?.company_sell?.comIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">채널유형</span>
                                                        </span>
                                                        <select name="poSellChannel" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.Channel).values()}" th:text="${opt.option}" th:value="${opt.name()}" th:selected="${po != null} and ${po?.poSellChannel} == ${opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미수대금</span>
                                                        </span>
                                                        <input type="text" name="poSellReceiveAmount" class="form-control text-right" th:value="${po?.poSellReceiveAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">미지급대금</span>
                                                        </span>
                                                        <input type="text" name="poUnpaidAmount" class="form-control text-right" th:value="${po?.poSellUnpaidAmount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">총판매액</span>
                                                        </span>
                                                        <input type="text" name="poSellTotalAmount" class="form-control text-right" th:value="${#numbers.formatInteger(po?.poSellTotalAmount,1,'COMMA')}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">대금지급일</span>
                                                        </span>
                                                        <input type="text" name="poSellPayDate" class="form-control w-datarange daterange-single" th:value="${po?.poSellPayDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">예상수익률</span>
                                                        </span>
                                                        <input type="text" name="poSellProfit" class="form-control" th:value="|${po?.poSellProfit}%|" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">사용용도</span>
                                                        </span>
                                                        <input type="text" name="poSellUse" class="form-control" th:value="${po?.poSellUse}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="mt-3">5. 계약조건</legend>
                                        <div class="row">
                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">입고예정일</span>
                                                        </span>
                                                        <input type="text" name="poInDate" class="form-control w-datarange daterange-single" th:value="${po?.poInDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">납기일</span>
                                                        </span>
                                                        <input type="text" name="poDueDate" class="form-control w-datarange daterange-single" th:value="${po?.poDueDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">반품기한</span>
                                                        </span>
                                                        <input type="text" name="poRefundDate" class="form-control w-datarange daterange-single" th:value="${po?.poRefundDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">A/S기한</span>
                                                        </span>
                                                        <input type="text" name="poAsDate" class="form-control w-datarange daterange-single" th:value="${po?.poAsDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">재매입</span>
                                                        </span>
                                                        <select name="poRepurchase" class="form-control select">
                                                            <option value="false">N</option>
                                                            <option value="true" th:selected="${po?.poRepurchase == 'Y'}">Y</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested d-flex justify-content-between">입고예정창고<a href="javascript:openWarehouseModal();" class="badge badge-sm badge-primary ml-1">검색</a></span>
                                                        </span>
                                                        <input type="text" name="whName" class="form-control" th:value="${po?.warehouse?.whName}" readonly>
                                                        <input type="hidden" name="whIdx" th:value="${po?.warehouse?.whIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">매입운송비 주체</span>
                                                        </span>
                                                        <select name="poDeliveryMain" class="form-control select">
                                                            <option th:each="opt: ${T(com.newper.constant.PoDeliveryMain).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${#strings.toString(po?.poDeliveryMain) eq opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">매입운송비</span>
                                                        </span>
                                                        <input type="text" name="poDeliveryCost" class="form-control text-right calculate" th:value="${#numbers.formatInteger(po?.poDeliveryCost,1,'COMMA')}" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">계산서발행월</span>
                                                        </span>
                                                        <input type="text" name="poTaxMonth" class="form-control w-datarange daterange-single" th:value="${po?.poTaxMonth}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">지급예정일</span>
                                                        </span>
                                                        <input type="text" name="poPayDate" class="form-control w-datarange daterange-single" th:value="${po?.poPayDate}" readonly>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text requested">입금계좌정보</span>
                                                        </span>
                                                        <input type="text" name="poPayAccount" class="form-control" th:value="${po?.poPayAccount}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text d-flex justify-content-between">계약정보<a onclick="openContractModal();" class="badge badge-sm badge-primary">검색</a></span>
                                                        </span>
                                                        <input type="text" name="ccName" class="form-control" th:value="${po?.contract?.ccName}" readonly>
                                                        <input type="hidden" name="ccIdx" th:value="${po?.contract?.ccIdx}">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">정산방식</span>
                                                        </span>
                                                        <select name="poCalType" class="form-control">
                                                            <option th:each="opt: ${T(com.newper.constant.CcCalType).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${#strings.toString(po?.poCalType) eq opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">정산주기</span>
                                                        </span>
                                                        <select name="poCycle" class="form-control">
                                                            <option th:each="opt: ${T(com.newper.constant.CcCycle).values()}" th:text="${opt.getOption()}" th:value="${opt.name()}" th:selected="${#strings.toString(po?.poCycle) eq opt.name()}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 입력필드 -->
                                            <div class="col-sm-12 col-md-3">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">계약번호</span>
                                                        </span>
                                                        <input type="text" name="ccNum" class="form-control" th:value="${po?.contract?.ccNum}" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <legend class="mt-3">6. 상품정보
                                            <a onclick="openProductModal()" class="btn btn-sm btn-primary ml-1">검색</a>
                                        </legend>
                                        <div class="row overflow-x-scroll">
                                            <input type="hidden" name="rowCnt">
                                            <input type="hidden" name="cnt">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th class="w-5">상품코드</th>
                                                        <th class="w-10">상품명</th>
                                                        <th>제품상태</th>
                                                        <th class="w-10">외부상품코드</th>
                                                        <th>브랜드</th>
                                                        <th class="w-7">옵션1</th>
                                                        <th class="w-7">옵션2</th>
                                                        <th class="w-7">옵션3</th>
                                                        <th>기준매입가</th>
                                                        <th>입고SPEC(예정)</th>
                                                        <th>판매SPEC(예정)</th>
                                                        <th>삭제</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="productTbody">
                                                    <tr class="defaultRow" th:hidden="${poProduct != null} ? 'hidden'">
                                                        <td colspan="12">
                                                            발주품의할 상품을 선택하십시오.
                                                        </td>
                                                    </tr>
                                                    <tr th:if="${poProduct != null}" th:each="i : ${poProduct}"><!--th:class="|productPoTr_${iStat.index} poProductTr|"-->
                                                        <td hidden><input type="text" name="ppIdx" th:value="${i.PP_IDX}"></td>
                                                        <td th:text="${i.P_IDX}"></td>
                                                        <td th:text="${i.P_NAME}"></td>
                                                        <td th:text="${i.P_TYPE1_STR}"></td>
                                                        <td th:text="${i.PP_MEMO}"></td>
                                                        <td th:text="${i.CATE_NAME}"></td>
                                                        <td th:text="${i.OPTION1}"></td>
                                                        <td th:text="${i.OPTION2}"></td>
                                                        <td th:text="${i.OPTION3}"></td>
                                                        <td class="text-right" th:text="${#numbers.formatInteger(i?.P_COST, 1, 'COMMA')}"></td>
                                                        <td th:text="${i.SPEC_BUY}"></td>
                                                        <td th:text="${i.SPEC_SELL}"></td>
                                                        <td><a th:if="${po.poState == 'WAITING'}" onclick="deleteProduct($(this))" class="btn btn-sm btn-warning">삭제</a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <legend class="mt-3">7. 상품예상공정</legend>
                                        <div class="row overflow-x-scroll">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th class="w-5">상품코드</th>
                                                        <th class="w-10">상품명</th>
                                                        <th>예상수리비용(1단위)</th>
                                                        <th>예상도색비용(1단위)</th>
                                                        <th>예상가공비용(1단위)</th>
                                                        <th>총예상공정비용(1단위)</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="processTbody">
                                                    <tr class="defaultRow" th:unless="${poProduct != null}">
                                                        <td colspan="6">발주품의할 상품을 선택하십시오.</td>
                                                    </tr>
                                                    <tr th:if="${poProduct != null}" th:each="i : ${poProduct}">
                                                        <td th:text="${i.P_IDX}"></td>
                                                        <td th:text="${i.P_NAME}"></td>
                                                        <td th:text="|${i.PP_FIX_MEMO}/${#numbers.formatInteger(i.PP_FIX_COST,1,'COMMA')}|"></td>
                                                        <td th:text="|${i.PP_PAINT_MEMO}/${#numbers.formatInteger(i.PP_PAINT_COST,1,'COMMA')}|"></td>
                                                        <td th:text="|${i.PP_PROCESS_MEMO}/${#numbers.formatInteger(i.PP_PROCESS_COST,1,'COMMA')}|"></td>
                                                        <td th:text="${#numbers.formatInteger((i.PRODUCT_COST),1,'COMMA')}"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <legend class="mt-3">8. 상품수익률</legend>
                                        <div class="row overflow-x-scroll">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th class="w-5">상품코드</th>
                                                        <th class="w-10">상품명</th>
                                                        <th class="w-7">구매단가</th>
                                                        <th class="w-7">매입수량</th>
                                                        <th>매입총액</th>
                                                        <th class="w-7">목표수익률</th>
                                                        <th>생산원가합</th>
                                                        <th>생산원가율</th>
                                                        <th class="w-7">예상판매가</th>
                                                        <th>예상판매가총액</th>
                                                        <th>총이익</th>
                                                        <th>수익률</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="rateTbody">
                                                    <tr class="defaultRow" th:unless="${poProduct != null}">
                                                        <td colspan="12">발주품의할 상품을 선택하십시오.</td>
                                                    </tr>
                                                    <tr th:if="${poProduct != null}" th:each="i : ${poProduct}" th:row-cnt="${iStat.index}">
                                                        <td th:text="${i.P_IDX}"></td>
                                                        <td th:text="${i.P_NAME}"></td>
                                                        <td class="text-right" th:text="${#numbers.formatInteger(i.PP_COST,1,'COMMA')}"></td>
                                                        <td class="text-right" th:text="${#numbers.formatInteger(i.PP_COUNT,1,'COMMA')}"></td>
                                                        <td class="text-right" th:id="|ppTotalCost_${iStat.index}|" th:text="${#numbers.formatInteger((i.TOTAL_BUY_COST),1,'COMMA')}"></td>
                                                        <td th:text="${i.PP_PROFIT_TARGET}"></td>
                                                        <td class="text-right" th:id="|ppTotalProdCost_${iStat.index}|" th:text="${#numbers.formatInteger(i.CREATE_PRICE,1,'COMMA')}"></td>
                                                        <td th:id="|ppProdCostRate_${iStat.index}|"></td>
                                                        <td class="text-right" th:text="${#numbers.formatInteger(i.PP_SELL_PRICE,1,'COMMA')}"></td>
                                                        <td class="text-right" th:id="|ppTotalSellPrice_${iStat.index}|" th:text="${#numbers.formatInteger(i.TOTAL_SELL_PRICE,1,'COMMA')}"></td>
                                                        <td class="text-right" th:id="|ppTotalProfit_${iStat.index}|" th:text="${#numbers.formatInteger(i.TOTAL_SELL_PRICE - i.CREATE_PRICE,1,'COMMA')}"></td>
                                                        <td th:id="|ppProfitRate_${iStat.index}|"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </fieldset>
                                    <!-- 타이틀 구분 끝-->
                                </div>
                            </div>
                        </form>
                        <!-- #regiForm end -->
                    </div>
                </div>
            </div>
            <!-- /content area -->

        </div>
        <!-- /inner content -->

        <!-- Footer -->
        <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
            <button type="button" class="btn btn-sm btn-light float-left" onclick="window.close();"><i class="icon-cross2 mr-1"></i>닫기</button>
            <button th:if="${po?.hiworks == null}" type="button" class="btn btn-sm btn-secondary ml-1" id="saveBtn"><i class="icon-floppy-disk mr-1"></i>저장</button>
        </div>
        <!-- /footer -->
    </div>
</div>
<!-- 공통 js -->
<script th:src="@{/assets/js/main/jquery.min.js}"></script>
<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/ui/moment/moment.min.js}"></script>
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>
<script th:src="@{/assets/js/plugins/pickers/daterangepicker.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 드래그&드랍 -->
<script th:src="@{/assets/js/demo_pages/extension_dnd.js}"></script>
<script th:src="@{/assets/js/plugins/ui/dragula.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>
<script th:src="@{/assets/js/demo_pages/picker_date.js}"></script>

<!-- 멀티 선택 (숫자) -->
<script th:src="@{/assets/js/plugins/forms/selects/bootstrap_multiselect.js}"></script>
<script th:src="@{/assets/js/demo_pages/form_multiselect.js}"></script>

<script th:src="@{/assets/js/autocomplete/autocomplete-jquery-ui.min.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<th:block th:replace="company/modal/companyModal.html"/>
<th:block th:replace="product/modal/productModal_po.html"/>
<th:block th:replace="goods/modal/warehouseModal.html"/>
<th:block th:replace="company/modal/contractModal.html"/>
<th:block th:replace="modal/userModal.html"/>


<script>
    var dnd = dragula([document.querySelector('#courseTbody')], {
        mirrorContainer: document.querySelector('#courseTbody'),
        moves: function (el, container, handle) {
            return handle.classList.contains('dragula-handle');
        }
    }).on('drop', function () {
        resetCourseNo();
    });

    function openContractModal() {
        var comIdx = $('input[name=comIdxBuy]').val();
        if (comIdx == '') {
            alert('매입처를 선택해 주세요.');
            return false;
        }

        $('#contractModalComIdx').val(comIdx);
        $('#contractModal').modal('show');
        selectContractDataTable();
    }

    function selectUser(row) {
        var rowData = getDatatablemap('userModalTable', row);
        prependRowToCourseTable(rowData);
        $('#searchUserModal').modal('hide');
    }

    function saveAction(){
        if ($('.defaultRow').attr('hidden') == 'hidden') {
            $('input[name=rowCnt]').val($('#productTbody tr').length);
        } else {
            $('input[name=rowCnt]').val(0);
        }

        $.each($('.text-won, .text-right, input[name=poSellProfit]'), function () {
            var num = $(this).val().replaceAll(/[^0-9.]/g, '');
            $(this).val(num);
        });

        $.each($('.percent_input'), function (index, value) {
            var val = $(this).val().replace('%', '');
            $(this).val(val);
        })

        $.ajax({
            url: location.pathname + '.ajax',
            processData: false,
            contentType: false,
            type: 'post',
            data: new FormData($('#createForm')[0]),
            success: function () {
                window.opener.refreshTable('#poTable');
            }
        });
    }

    // 거래처 검색 선택
    var companyFlag = '';
    function openCompanyModal_flag (flag) {
        companyFlag = flag;
        $('#companyModalType').hide();
        $('#companyModalForm select[name=ctType]').val(flag);
        openCompanyModal();
    }

    function companySelect(row){
        var rowData = $('#companyModalTable').DataTable().rows(row).data()[0];

        if (companyFlag == 'PURCHASE') {
            $('input[name=uName]').val(rowData.U_NAME);
            $('input[name=uIdx]').val(rowData.U_IDX);
            $('input[name=comIdxBuy]').val(rowData.COM_IDX);
            $('input[name=comNameBuy]').val(rowData.COM_NAME);
        } else {
            $('input[name=comIdxSell]').val(rowData.COM_IDX);
            $('input[name=comNameSell]').val(rowData.COM_NAME);
        }
        $('#companyModal').modal('hide');
    }

    //거래처 모달에서 선택
    function contractSelect(row){
        var rowData = $('#contractModalTable').DataTable().rows(row).data()[0];

        $('input[name=ccIdx]').val(rowData.CC_IDX);
        $('input[name=ccName]').val(rowData.CC_NAME);
        $('input[name=ccType]').val(rowData.CC_TYPE_STR);
        $('input[name=ccCycle]').val(rowData.CC_CYCLE_STR);
        $('input[name=ccNum]').val(rowData.CC_NUM);
        $('input[name=poPayAccount]').val(rowData.COM_ACCOUNT);

        console.log(rowData.CC_CAL_TYPE_STR)
        console.log(rowData.CC_CYCLE_STR)
        $('select[name=poCalType] option[value='+rowData.CC_CAL_TYPE+']').prop('selected', true);
        $('select[name=poCycle] option[value='+rowData.CC_CYCLE+']').prop('selected', true);

        $('#contractModal').modal('hide');
    }

    /**품의경로 삭제*/
    function deleteCourse(el) {
        var target = el.closest('tr');
        target.remove();
        if ($('#courseTbody tr').length < 1) {
            $('#courseTbody').append('<tr id="courseDefault"><td colspan="8">품의경로를 입력하십시오</td></tr>');
        }
        resetCourseNo();
    }

    /** 상품삭제*/
    function deleteProduct(el) {
        var target = el.closest('tr');
        var rowIdx = target.index();
        target.remove();
        $('#rateTbody tr')[rowIdx].remove();
        $('#processTbody tr')[rowIdx].remove();

        // po총액들 새로계산
        calculatePo();

        // 기본행 보여주기
        if ($('#rateTbody tr').length < 2) {
            $('.defaultRow').attr('hidden', false);
        }
    }

    var poOrder = 0;
    if ([[${poProduct != null}]]) {
        poOrder = $('#courseTbody tr').length;
    }
    /**품의경로 테이블 새로운 행 더하기*/
    function prependRowToCourseTable(data) {
        $('#courseDefault').remove();
        $('#courseTbody').prepend(
            '<tr>' +
            '   <td class="dragula-handle course-no">' +
            '       <i class="icon-menu-open"></i><span>'+(poOrder+1)+'</span>' +
            '       <input type="hidden" name="order_'+poOrder+'" value="'+poOrder+'">' +
            '   </td>' +
            '   <td><input type="hidden" name="hwAprvId_'+poOrder+'" value="'+data.U_ID+'">'+data.U_NAME+'</td>' +
            '   <td id="hwType_'+poOrder+'"></td>' +
            '   <td><input type="text" name="hwMemo_'+poOrder+'" class="form-control"></td>' +
            '   <td></td>' +
            '   <td></td>' +
            '   <td></td>' +
            '   <td><a onclick="deleteCourse($(this))" class="btn btn-sm btn-warning">삭제</a></td>' +
            '</tr>'
        );

        $('#hwType_'+poOrder).append($('select[name=hwType]:first').clone().removeClass('select2-hidden-accessible').attr('name','hwType_'+poOrder));

        poOrder++;
        $('input[name=hwCnt]').val(poOrder);
    }

    /**품의경로 no 다시 부여*/
    function resetCourseNo() {
        var len = $('.course-no').length - $('.gu-mirror').length;
        $.each($('.course-no'), function (index, value) {
            $(this).find('span').text(len--);
            $(this).find('input').val(len);
        });
    }

    var cnt = 0;
    if ([[${poProduct != null}]]) {
        cnt = $('#productTbody tr').length;
    }
    /** product테이블 새로운 행 더하기*/
    function appendRowToProductTable(data) {
        var brandName = '';
        if (data.BRAND_NAME != null && data.BRAND_NAME != '') {
            brandName = data.BRAND_NAME;
        }
        // product테이블 행추가
        $('#productTbody').append(
            '<tr class="mb--1">' +
            '   <td><input type="hidden" name="pIdx_'+cnt+'" value="'+data.P_IDX+'">'+data.P_IDX+'</td>' +
            '   <td>'+data.P_NAME+'</td>' +
            '   <td>'+data.P_TYPE1_STR+'</td>' +
            '   <td><input type="text" name="ppMemo_'+cnt+'" class="form-control"></td>' +
            '   <td>'+brandName+'</td>' +
            '   <td id="ppOption1_'+cnt+'"></td>' +
            '   <td id="ppOption2_'+cnt+'"></td>' +
            '   <td id="ppOption3_'+cnt+'"></td>' +
            '   <td>'+comma(data.P_COST)+'</td>' +
            '   <td id="poBuySpec_'+cnt+'"></td>' +
            '   <td id="poSellSpec_'+cnt+'"></td>' +
            '   <td><a href="#" onclick="deleteProduct($(this))" class="badge badge-warning">삭제</a></td>' +
            '</tr>'
        );

        //option selectBox 추가
        var options = JSON.parse(data.P_OPTION);
        for (var i = 0; i < options.length; i++) {
            var selectName = 'ppOption'+(i+1)+'_'+cnt;
            var optVal = options[i].values;
            $('#'+selectName).append(
                '<input type="hidden" name="title_'+selectName+'" value="'+options[i].title+'"><select name="'+selectName+'" class="form-control"></select>'
            );


            for (var ov of optVal) {
                $('select[name="'+selectName+'"]').append(
                    '<option value="'+ov+'">'+ov+'</option>'
                );
            }
        }

        // spec input 추가
        var cateSpecList = data.CATE_SPEC_LIST;
        if (cateSpecList != null && cateSpecList != '') {
            var specList = JSON.parse(data.CATE_SPEC_LIST);
            var specCnt = 0;
            for (var i = 0; i < specList.length; i++) {
                $('#poBuySpec_'+cnt).append(
                    '<div class="d-flex">' +
                    '   <input type="text" name="buySpeclName_'+cnt+'" class="form-control mb--1 mr--1 specl-name" value="'+specList[i]+'" readonly tabindex="-1">' +
                    '   <input type="text" name="buySpeclValue_'+cnt+'" spec-list="'+specCnt+'" class="form-control mb--1">' +
                    '</div>'
                );
                $('#poSellSpec_'+cnt).append(
                    '<div class="d-flex">' +
                    '   <input type="text" name="sellSpeclName_'+cnt+'" class="form-control mb--1 mr--1" value="'+specList[i]+'" readonly tabindex="-1">' +
                    '   <input type="text" name="sellSpeclValue_'+cnt+'" spec-list="'+specCnt+'" class="form-control mb--1">' +
                    '</div>'
                );
                specCnt++;
            }
        }

        // spec input auto complete
        var specNames = $('.specl-name');
        for (var i = 0; i < specNames.length; i++) {
            $.ajax({
                type: "GET",
                url:"/goods/specList.ajax?speclName=" + specNames[i].value,
                async:false,
                success : function(result){
                    $('input[spec-list='+i+']').autocomplete({
                        source: result
                        ,minLength: 0
                    });
                }
            });
        }
        // 이미 추가된 행 중복으로 검색하지 않도록 속성 제거
        specNames.removeClass('specl-name');
        $('input[spec-list]').removeAttr('spec-list');

        // 상품공정테이블 행추가
        $('#processTbody').append(
            '<tr>' +
            '   <td>'+data.P_IDX+'</td>' +
            '   <td>'+data.P_NAME+'</td>' +
            '   <td class="pr-5">' +
            '       <span class="d-flex align-items-center mb--1"><label class="w-10">항목</label><input type="text" name="ppFixMemo_'+cnt+'" class="form-control"></span>' +
            '       <span class="d-flex align-items-center"><label class="w-10">비용</label><input type="text" name="ppFixCost_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'"></span class="d-flex align-items-center">' +
            '   </td>' +
            '   <td class="pr-5">' +
            '       <span class="d-flex align-items-center mb--1"><label class="w-10">항목</label><input type="text" name="ppPaintMemo_'+cnt+'" class="form-control"></span>' +
            '       <span class="d-flex align-items-center"><label class="w-10">비용</label><input type="text" name="ppPaintCost_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'"></span>' +
            '   </td>' +
            '   <td class="pr-5">' +
            '       <span class="d-flex align-items-center mb--1"><label class="w-10">항목</label><input type="text" name="ppProcessMemo_'+cnt+'" class="form-control"></span>' +
            '       <span class="d-flex align-items-center"><label class="w-10">비용</label><input type="text" name="ppProcessCost_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'"></span>' +
            '   </td>' +
            '   <td id="ppTotalProcCost_'+cnt+'"></td>' + // 총예상공정비용
            '</tr>'
        );

        // 수익률테이블 행추가
        $('#rateTbody').append(
            '<tr>' +
            '   <td>'+data.P_IDX+'</td>' +
            '   <td>'+data.P_NAME+'</td>' +
            '   <td><input type="text" name="ppCost_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'" value="'+comma(data.P_COST)+'"></td>' +
            '   <td><input type="text" name="ppCount_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'" placeholder="0"></td>' +
            '   <td id="ppTotalCost_'+cnt+'" class="text-right">0</td>' + // 매입총액
            '   <td><input type="text" class="percent_input"  name="ppProfitTarget_'+cnt+'" class="form-control"></td>' +
            '   <td id="ppTotalProdCost_'+cnt+'" class="text-right"></td>' + // 생산원가합
            '   <td id="ppProdCostRate_'+cnt+'"></td>' +
            '   <td><input type="text" name="ppSellPrice_'+cnt+'" class="form-control text-won calculate" row-cnt="'+cnt+'" placeholder="0"></td>' +
            '   <td id="ppTotalSellPrice_'+cnt+'" class="text-right"></td>' + //예상판매가총액
            '   <td id="ppTotalProfit_'+cnt+'" class="text-right"></td>' + //총이익
            '   <td id="ppProfitRate_'+cnt+'"></td>' +
            '</tr>'
        );

        // 숫자만 입력되도록
        $('.percent_input').on("input", function (event) {
            var value = $(this).val().replace('%', "");
            $(this).val(value + '%');
        });

        // 숫자만 입력되도록
        $('.text-won').on("input", function (event) {
            inputOnlyNumber($(event.target))
        });

        // 계산식들 계산
        $('.calculate').on("keyup", function (event) {
            calculateAll($(event.target));
        });

        cnt++;
        $('input[name="cnt"]').val(cnt);
    }

    /**숫자로 입력되어야하는 input들 처리*/
    function inputOnlyNumber(el) {
        var value = comma(el.val().replace(/[^0-9]/g, ""));
        el.val(value);
    }

    /**계산할것들 계산*/
    function calculateAll(el) {
        var rowCnt = el.attr("row-cnt");

        //pp별 매입총액 계산
        var ppCost = getNumberInInput("ppCost_"+rowCnt);
        var ppCount = getNumberInInput("ppCount_"+rowCnt);
        var ppTotalCost = ppCost * ppCount;
        $('#ppTotalCost_'+rowCnt).text(comma(ppTotalCost));

        //pp별 총예상공정비용 계산
        var ppFixCost = getNumberInInput("ppFixCost_"+rowCnt);
        var ppPaintCost = getNumberInInput("ppPaintCost_"+rowCnt);
        var ppProcessCost = getNumberInInput("ppProcessCost_"+rowCnt);
        var ppTotalProcCost = ppFixCost + ppPaintCost + ppProcessCost;
        $('#ppTotalProcCost_'+rowCnt).text(comma(ppTotalProcCost));

        //pp별 생산원가합 계산 => 매입총액+(상품예상공정비용합*매입수량)
        var ppTotalProdCost = ppTotalCost+(ppTotalProcCost*ppCount);
        $('#ppTotalProdCost_'+rowCnt).text(comma(ppTotalProdCost));

        //예상판매가총액 계산 => 예상판매가*매입수량
        var ppSellPrice = getNumberInInput("ppSellPrice_"+rowCnt);
        var ppTotalSellPrice = ppSellPrice * ppCount;
        $('#ppTotalSellPrice_'+rowCnt).text(comma(ppTotalSellPrice));

        // 총이익 계산
        var ppTotalProfit = ppTotalSellPrice - ppTotalProdCost;
        $('#ppTotalProfit_'+rowCnt).text(comma(ppTotalProfit));

        //pp별 생산원가율 계산 => (생산원가합/예상판매가총액)*100, 수익률 => 1-생산원가율
        if (ppTotalSellPrice != 0) {
            calculateRate(ppTotalProdCost,ppTotalSellPrice,rowCnt);
            calculatePo();
        }

    }

    /**나눗셈 계산*/
    function calculateRate(ppTotalProdCost, ppTotalSellPrice, rowCnt) {
        //pp별 생산원가율 계산 => (생산원가합/예상판매가총액)*100, 수익률 => 1-생산원가율
        var ppProdCostRate = Math.round((ppTotalProdCost/ppTotalSellPrice)*10000)/100;
        var ppProfitRate = Math.round((100-ppProdCostRate)*100)/100;
        $('#ppProdCostRate_'+rowCnt).text(comma(ppProdCostRate)+'%');
        $('#ppProfitRate_'+rowCnt).text(comma(ppProfitRate)+'%');
    }

    /** po 총구매액, 총판매액, 예상수익률 계산*/
    function calculatePo() {
        var len = $('#rateTbody tr').length;
        var totalCost = 0; var totalSell = 0; var totalProfit = 0;

        var deliveryCost = getNumberInInput('poDeliveryCost');

        var totalProdCost = 0;
        for (var i = 0; i < len; i++) {
            if (isNaN(getNumberById('ppTotalCost_' + i))) {
                continue;
            }
            totalProdCost += getNumberById('ppTotalProdCost_'+i)
            totalSell += getNumberById('ppTotalSellPrice_'+i);
            totalProfit += getNumberById('ppTotalProfit_'+i);
        }
        var totalProfitRate = totalProfit / totalSell * 100
        $('input[name=poTotalAmount]').val(comma(totalCost));
        $('input[name=poSellTotalAmount]').val(comma(totalSell));

        $('input[name=poSellProfit]').val(Math.round(totalProfitRate)+'%');
    }

    /**input value에서 특수문자를 제외하고 숫자형태로 return*/
    function getNumberInInput(name) {
        return Number($('input[name="'+name+'"]').val().replace(/[^0-9]/g,""));
    }

    /**id를 통해 특수문자 제외한 숫자형태 return*/
    function getNumberById(id) {
        return Number($('#'+id).text().replace(/[^0-9]/g,""));
    }

    changePoDeliveryMain($('select[name=poDeliveryMain]'));
    /**매입운송비 주체 변경시 input창 변화*/
    function changePoDeliveryMain(el) {
        if (el.val() != '[[${T(com.newper.constant.PoDeliveryMain).MAIN}]]') {
            $('input[name=poDeliveryCost]').val('').attr('readonly', true);
        } else {
            $('input[name=poDeliveryCost]').val('').attr('readonly', false);
        }
    }
</script>
<script>
    $("#saveBtn").on("click", saveAction);
    // 숫자만 입력되도록
    $('.text-won').on("input", function (event) {
        inputOnlyNumber($(event.target))
    });
    $('select[name=poDeliveryMain]').on('change', function (event) {
        changePoDeliveryMain($(event.target));
    });
    $('#userModalForm').on('keyup',function(event){
        if(event.keyCode==13){searchUserForCompany();return false;}
    });
    $('.text-right').on('input', function(event){
        inputOnlyNumber($(event.target));
    });
</script>
<script th:inline="javascript" th:if="${poProduct != null}">
    var len = $('#rateTbody tr').length;
    for (var i = 0; i < len; i++) {
        var ppTotalProdCost = getNumberById('ppTotalProdCost_'+i);
        var ppTotalSellPrice = getNumberById('ppTotalSellPrice_'+i);
        calculateRate(ppTotalProdCost, ppTotalSellPrice, i);
    }
</script>
</body>
</html>
