<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<div class="modal" tabindex="-1" role="dialog" id="productModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">입고검수 리포트 등록</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
               <div class="col-lg-12" id="ProductDiv">
                    <form id="productModalForm">
                        <div class="card mb-1">
                            <div class="card-body popup-contents mb-1">

                                <fieldset class="mb-0">
                                    <legend class="">1. 자산정보</legend>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">상품코드</span>
                                                    </span>
                                                    <input type="text" class="form-control" name="pIdx" id="pIdx" readonly>
                                                    <input type="hidden" name="poIdx" id="poIdx">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">상품명</span>
                                                    </span>
                                                    <input type="text" class="form-control" id="pName" readonly>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">자산코드</span>
                                                    </span>
                                                    <input type="text" class="form-control" name="gIdx" id="gIdx" readonly>
                                                    <input type="hidden" name="cgsIdx" id="cgsIdx">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">IMEI</span>
                                                    </span>
                                                    <input type="text" class="form-control" name="gImei" id="IMEI">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="mt-3">
                                    <legend class="">2. 상품 SPEC정보</legend>
                                    <div class="row">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>SPEC명</th>
                                                <th>입고SPEC(예정)</th>
                                                <th>입고SPEC(확정)</th>
                                                <th>판매SPEC(예정)</th>
                                                <th>가공SPEC(예정)</th>
                                            </tr>
                                            </thead>
                                            <tbody id="poModalProductSpecList">

                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>

                                <!-- 타이틀 -->
                                <fieldset class="mt-3">
                                    <legend class="">3. 예상비용</legend>
                                    <div class="row">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>공정구분</th>
                                                    <th>예상공정항목</th>
                                                    <th>예상비용</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>도색</td>
                                                    <td><input type="text" name="paintMemo" class="form-control"></td>
                                                    <td><input type="text" name="paintCost" class="form-control"></td>
                                                </tr>
                                                <tr>
                                                    <td>수리</td>
                                                    <td><input type="text" name="fixMemo" class="form-control"></td>
                                                    <td><input type="text" name="fixCost" class="form-control"></td>
                                                </tr>
                                                <tr>
                                                    <td>가공</td>
                                                    <td><input type="text" name="processMemo" class="form-control"></td>
                                                    <td><input type="text" name="processCost" class="form-control"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </fieldset>

                                <fieldset class="mt-3">
                                    <legend class="">4. 옵션</legend>
                                    <div class="row">
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">옵션1</span>
                                                    </span>
                                                    <select name="productOption" id="productOption1" class="form-control"></select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">옵션2</span>
                                                    </span>
                                                    <select name="productOption" id="productOption2" class="form-control"></select>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">옵션3</span>
                                                    </span>
                                                    <select name="productOption" id="productOption3" class="form-control"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="mt-3">
                                    <legend class="">5. 첨부파일</legend>
                                    <div class="row">
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">첨부파일</span>
                                                    </span>
                                                    <input type="file" class="form-control" name="gFile" multiple>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="mt-3">
                                    <legend class="">6. 메모</legend>
                                    <div class="row">
                                        <!-- 입력필드 -->
                                        <div class="col-sm-12 col-md-12">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">메모</span>
                                                    </span>
                                                    <input type="input" class="form-control" name="gMemo">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </form>
                </div>

            </div>

            <!-- Footer -->
            <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
                <button type="button" class="btn btn-sm btn-secondary ml-1" id="setBtnProductModal" onclick="goodsSpecSetting();">저장</button>
            </div>
            <!-- /footer -->
        </div>
    </div>
</div>

<script>
    function goodsSpecSetting () {
        var flag = true;
        $.each($('input[name=porSpec1]'), function (index, value) {
            if ($(this).val() == '') {
                flag = false;
                return false;
            }
        });

        if (flag == false) {
            alert('입고SPEC(확정)을 입력해 주세요');
            return false;
        }

        $.ajax({
            type: "POST",
            url:"/in/checkGoodsSpecSet.ajax?" + $('#productModalForm').serialize(),
            async: false,
            success : function(result){
                $('#pIdx').val('');
                $('#pName').val('');
                $('#gIdx').val('');
                $('#porIdx').val('');
                $('#IMEI').val('');
                $('#poModalProductSpecList').empty();
                $('#paintMemo').val('');
                $('#paintCost').val('');
                $('#fixMemo').val('');
                $('#fixCost').val('');
                $('#processMemo').val('');
                $('#processCost').val('');

                $('#productModal').hide();
                searchBtn();
            }
        });
    }

    function openSpecModal_CGS (id, rowIdx) {
        $('#productModal').modal('show');
        var dataMap = getDatatablemap(id, rowIdx);

        if(dataMap.CATE_SPEC_LIST != null){
            var specList = JSON.parse(dataMap.CATE_SPEC_LIST);
            $('#poModalProductSpecList').empty();
            for (var i = 0; i < specList.length; i++) {
                var specValue = "";
                var specValue2 = "";
                if (dataMap.SPEC1 != null) {
                    specValue = dataMap.SPEC1.split("/")[i].split(":")[1]
                }

                if (dataMap.SPEC2 != null) {
                    specValue2 = dataMap.SPEC2.split("/")[i].split(":")[1]
                }

                var specTr
                    ='<tr>'
                    +'<td id="specList'+i+'" class="specListTd">'+specList[i]+'</td>'
                    +'<input type="hidden" name="specName" value="' + specList[i] + '">'
                    +'<td><input type="text" specList="'+i+'" class="form-control" readonly></td>'
                    +'<td><input type="text" specList="'+i+'" name="porSpec1" class="form-control" value="' + specValue + '"></td>'
                    +'<td><input type="text" specList="'+i+'" class="form-control" readonly></td>'
                    +'<td><input type="text" specList="'+i+'" name="porSpec2" class="form-control" value="' + specValue2 + '"></td>'
                    +'</tr>';

                $('#poModalProductSpecList').append(specTr);
            }


            var specListTd = $('.specListTd');
            for (var i = 0; i < specListTd.length; i++) {
                $.ajax({
                    type: "GET",
                    url:"/goods/specList.ajax?specName=" + specListTd[i].innerHTML,
                    async:false,
                    success : function(result){
                        $('input[specList='+i+']').autocomplete({
                            source: result
                            ,minLength: 0
                        });
                    }
                });
            }

            var options = JSON.parse(dataMap.P_OPTION);
            for (var i = 0; i < 3; i++) {
                var num = parseInt(i) + 1;
                $('#productOption' + num).empty();
                $('#productOption' + num).append('<option value="">없음</option>');
            }

            for (var i = 0; i < options.length; i++) {
                var text = '';
                for (var j = 0; j < options[i].values.length; j++) {
                    text += '<option value="' + options[i].title + ':' + options[i].values[j] + '">' + options[i].values[j] +'</option>'
                }
                var num = parseInt(i) + 1;
                $('#productOption' + num).empty();
                $('#productOption' + num).append(text);
            }






            $('#pIdx').val(dataMap.P_IDX);
            $('#pName').val(dataMap.P_NAME);
            $('#gIdx').val(dataMap.G_IDX);
            $('#cgsIdx').val(dataMap.CGS_IDX);
            $('#poIdx').val(dataMap.PO_IDX);
        }
    }
</script>
</html>
