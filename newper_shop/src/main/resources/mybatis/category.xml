<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.CategoryMapper">
    <select id="selectAllCategoryByShopProduct" resultType="map" parameterType="map">
        SELECT
            CATE_NAME
             ,CATE_NICK
             ,CATE_ICON
             ,CATE_THUMBNAIL
             ,CATE_IMAGE
             ,CATE_ORDER
             ,CATE_SPEC
             ,CATE_SPEC_LIST
             ,CATE_INFO
        FROM (
            SELECT
                DISTINCT(SP_CATE_IDX) SP_CATE_IDX
            FROM
                shop_product
               ,CATEGORY
            WHERE SP_CATE_IDX = CATE_IDX
              AND SP_SHOP_IDX=#{shopIdx}
        ) SP_CATE
           ,CATEGORY
           ,SHOP_CATEGORY
           ,CATEGORY_SHOP_CATEGORY
        WHERE
            SP_CATE_IDX = CATE_IDX
          AND CSC_SCATE_IDX = SCATE_IDX
          AND CSC_CATE_IDX = CATE_IDX
          AND CATE_TYPE = 'CATEGORY'
          AND CATE_DEPTH = '2'
          AND SCATE_IDX = #{scateIdx}

    </select>
    <select id="selectShopCategoryBySp" resultType="map">
        SELECT
            SCATE_IDX, SCATE_NAME
        FROM
            CATEGORY_SHOP_CATEGORY, SHOP_CATEGORY,SHOP_PRODUCT
        WHERE
            SCATE_IDX = CSC_SCATE_IDX
            AND CSC_CATE_IDX=SP_CATE_IDX
            and SP_IDX = #{sp_idx}
    </select>
    <select id="selectAllShopCategory" resultType="map">
        SELECT
            *
        FROM
            SHOP_CATEGORY
        WHERE
            SCATE_ORDER > 0
        ORDER BY SCATE_ORDER ASC
    </select>
    <select id="selectAllMiddleCategory" resultType="map">
        SELECT
            CSC_SCATE_IDX
             , CATE_IDX
             , CATE_NAME
             , CATE_ORDER
        FROM
            CATEGORY
           ,CATEGORY_SHOP_CATEGORY
        WHERE
            CSC_CATE_IDX = CATE_IDX
            AND CATE_DEPTH = 2
            AND CATE_ORDER > 0
        ORDER BY CATE_ORDER ASC
    </select>
    <select id="selectAllSmallCategory" resultType="map">
        SELECT
            CATE_PARENT_IDX
             , CATE_IDX
             , CATE_NAME
             , CATE_ORDER
        FROM
            CATEGORY
        WHERE
            CATE_DEPTH=3
            AND CATE_ORDER > 0
        ORDER BY CATE_ORDER ASC
    </select>
    <select id="selectAllCategoryByProduct" resultType="map" parameterType="Integer">
        SELECT
            SP_SHOP_IDX SHOP_IDX
             , SMALL_CATE.CATE_IDX SMALL_CATE_IDX
             , SMALL_CATE.CATE_NAME SMALL_CATE_NAME
             , MIDDLE_CATE.CATE_IDX MIDDLE_CATE_IDX
             , MIDDLE_CATE.CATE_NAME MIDDLE_CATE_NAME
             , CSC_SCATE_IDX
        FROM
            SHOP_PRODUCT
           ,CATEGORY SMALL_CATE
           ,CATEGORY MIDDLE_CATE
           ,CATEGORY_SHOP_CATEGORY
        WHERE
            SP_CATE_IDX=SMALL_CATE.CATE_IDX
            AND MIDDLE_CATE.CATE_IDX=SMALL_CATE.CATE_PARENT_IDX
            AND CSC_CATE_IDX = MIDDLE_CATE.CATE_IDX
            AND SP_SHOP_IDX = #{shopIdx}
        GROUP BY
            SP_SHOP_IDX
           ,SMALL_CATE.CATE_IDX
           ,SMALL_CATE.CATE_NAME
           ,MIDDLE_CATE.CATE_IDX
           ,MIDDLE_CATE.CATE_NAME
           ,CSC_SCATE_IDX
    </select>
    <select id="selectCategoryMenuName" resultType="map" parameterType="map">
        SELECT
            SCATE_NAME
            <if test="parentCateIdx != null and parentCateIdx !=''">
                ,MIDDLE.CATE_NAME MIDDLE_NAME
            </if>
            <if test="cateIdx != null and cateIdx !=''">
                ,SMALL.CATE_NAME SMALL_NAME
            </if>
        FROM
            SHOP_CATEGORY
            <if test="parentCateIdx != null and parentCateIdx !=''">
               ,CATEGORY_SHOP_CATEGORY
               ,CATEGORY MIDDLE
            </if>
            <if test="cateIdx != null and cateIdx !=''">
               ,CATEGORY SMALL
            </if>
        WHERE
            SCATE_IDX = #{scateIdx}
            <if test="parentCateIdx != null and parentCateIdx !=''">
                AND SCATE_IDX = CSC_SCATE_IDX
                AND MIDDLE.CATE_IDX = CSC_CATE_IDX
                AND MIDDLE.CATE_IDX = #{parentCateIdx}
            </if>
            <if test="cateIdx != null and cateIdx !=''">
                AND MIDDLE.CATE_IDX = SMALL.CATE_PARENT_IDX
                AND SMALL.CATE_IDX = #{cateIdx}
            </if>
    </select>
</mapper>