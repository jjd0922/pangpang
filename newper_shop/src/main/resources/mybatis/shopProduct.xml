<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.ShopProductMapper">
    <select id="selectShopProductOptionList" resultType="map">
        SELECT
            SHOP_PRODUCT_OPTION.*
             ,FORMAT(SPO_PRICE, 0 ) SPO_PRICE_F
        FROM SHOP_PRODUCT_OPTION, SHOP_PRODUCT_ADD
        WHERE
            SPO_SPA_IDX = SPA_IDX
            AND SPA_SP_IDX = #{sp_idx}
        ORDER BY SPO_IDX ASC
    </select>

    <select id="selectscateMainSectionProductList" parameterType="map" resultType="map">
        SELECT
            *
        FROM
            SHOP_PRODUCT
            ,SHOP_CATEGORY
            ,CATEGORY_SHOP_CATEGORY
            ,CATEGORY
            ,MAIN_SECTION
            ,MAIN_SECTION_SP
        WHERE
            CSC_SCATE_IDX = SCATE_IDX
            AND CSC_CATE_IDX = CATE_IDX
            AND SP_CATE_IDX = CATE_IDX
            AND MSSP_MS_IDX = MS_IDX
            AND MSSP_SP_IDX = SP_IDX
            AND MS_IDX = #{msIdx}
            AND SCATE_IDX = #{scateIdx}
    </select>
    <sql id="includeCategoryProductList">
        mid_cate.CATE_IDX = csc.CSC_CATE_IDX
        AND scate.SCATE_IDX = csc.CSC_SCATE_IDX
        AND sp.SP_CATE_IDX = small_cate.CATE_IDX
        AND small_cate.CATE_PARENT_IDX = mid_cate.cate_idx
        AND scate.SCATE_IDX = #{scateIdx}
        <if test="parentCateIdx != null and parentCateIdx !=''">
            AND mid_cate.CATE_IDX = #{parentCateIdx}
        </if>
        <if test="cateIdx != null and cateIdx !=''">
            AND small_cate.CATE_IDX = #{cateIdx}
        </if>
    </sql>
    <select id="selectCategoryProductList" resultType="map" parameterType="map">
        SELECT
            sp.*
        FROM
            category mid_cate
           ,shop_category scate
           ,category_shop_category csc
           ,shop_product sp
           ,category small_cate
        WHERE
            <include refid="includeCategoryProductList"/>
    </select>
    <select id="countCategoryProductList" resultType="Integer" parameterType="map">
        SELECT
            count(sp.sp_idx) cnt
        FROM
            category mid_cate
           ,shop_category scate
           ,category_shop_category csc
           ,shop_product sp
           ,category small_cate
        WHERE
            <include refid="includeCategoryProductList"/>
    </select>
</mapper>