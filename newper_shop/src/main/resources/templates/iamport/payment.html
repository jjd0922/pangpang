<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript" th:src="@{/js/core/jquery-3.6.0.min.js}"></script>
    <script th:src="@{/js/iamport.payment-1.1.8.js}"></script>
</head>
<body>

</body>
<script>
    //결제팝업
    var payRequestAvailable = true;
    function payRequest(){
        if(payRequestAvailable){
            payRequestAvailable = false;
            $.ajax({
              url:'/orders/iamport/pay.ajax'
              ,type:'post'
            }).done(function(res){
                var IMP = window.IMP;
                IMP.init(res.data.id);
                IMP.request_pay(res.data.req, function (rsp) {

                    $.ajax({
                        url:'/orders/iamport/result.ajax'
                        ,type:'post'
                        ,contentType: 'application/json'
                        ,data: JSON.stringify(rsp)
                        ,async:false
                    });

                    if(rsp.success){
                        //결제 성공 페이지로 이동

                    }else{
                        alert(rsp.error_msg);
                    }



                });

            }).always(function(){
                payRequestAvailable = true;
            });
        }else{
            console.log('not available');
        }
    }
</script>
<script>
</script>
</html>