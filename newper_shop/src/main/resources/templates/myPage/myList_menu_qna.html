<!-- 1:1문의내역-->
<th:block th:fragment="qnaHistory">
    <div class="display-flex space-between">
        <div class="page-des">
            <p><span class="color-red">※</span>&nbsp;&nbsp;쇼핑과 관련하여 궁금하신 사항을 알려드립니다.
            </p>
            <p><span class="color-red">※</span>&nbsp;&nbsp;언제나 친절/신속하게 답변해드릴 것을 약속드리며, 궁금하신 사항은 문의하기 버튼을 클릭하셔서 문의해주세요!</p>
        </div>
        <a onclick="qnaInsertModal(null)" class="btn btn-xxlg btn-point-outline btn-width-md radius-xlarge origin-btn">1:1 문의하기</a>
    </div>

    <!-- 테이블 -->
    <div>
        <!-- 1:1문의 테이블 제목 -->
        <ul class="table-title2 font-sm direct-inquiry-table-title">
            <li>주문번호</li>
            <li>문의유형</li>
            <li>문의제목</li>
            <li>답변상태</li>
            <li>작성일</li>
            <li></li>
        </ul>
        <!-- 1:1문의 상품 리스트 -->
        <ul>
            <!-- 상품 1 -->
            <li>
                <ul class="table-content2 direct-inquiry-table-content">
                    <!-- 주문번호 -->
                    <li>
                        <p class="bold">123456873131</p>
                    </li>
                    <!-- 문의유형 -->
                    <li class="inquiry-type">
                        <p class="semi-bold">주문/결제확인 > 주문내역확인</p>
                    </li>
                    <!-- 문의제목 -->
                    <li class="inquiry-title">
                        <p class="semi-bold">배송이 언제되나요?</p>
                    </li>
                    <!-- 답변상태 -->
                    <li>
                        <!-- 답변대기
                        <p class="semi-bold">답변대기</p>-->
                        <!-- 답변완료 -->
                        <p class="color-red semi-bold">답변완료</p>
                    </li>
                    <!-- 배송완료일 -->
                    <li>
                        <p class="bold">2022.08.10</p>
                    </li>
                    <!-- 버튼 -->
                    <li class="flex-column button-vertical-group">
                        <a onclick="qnaInsertModal(null)" class="btn btn-xs btn-point btn-width-xs radius-xlarge">수정하기</a>
                        <a onclick="alert('준비중')" class="btn btn-xs btn-dark-gray-outline btn-width-xs radius-xlarge">삭제</a>
                    </li>
                </ul>
                <div class="inquiry-open font-md">
                    <div>
                        <div>
                            <span class="inquiry-badge font-xxsm">문의</span>
                        </div>
                        <p class="color-grey666">배송 언제되는지 정확한 날짜가 알고 싶어요~~!</p>
                    </div>
                    <div>
                        <div>
                            <span class="inquiry-answer font-xxsm">답변</span>
                        </div>
                        <p class="color-grey666">안녕하세요 고객님!! 뉴퍼마켓을 이용해주셔서 감사합니다.<br>
                            뉴퍼마켓 직배송 상품
                            - 결제 후 1일~2일이내 발송되어 받아보시는데까지 약 2~3일 소요됩니다.
                            부득이 주문량 많아 발송이 지연되는 경우(5일 이상) 별도 안내 or 공지드리오니 안심하셔도 됩니다.<br>
                            입점업체 배송 상품
                            - 업체 사정에 따라, 결제 후 2일~3일 이내 발송되어 받아보시는데까지 약 3~4일 소요 됩니다.
                            - 단, 대형가전(TV, 냉장고, 세탁기 등), 설치상품, 주문제작상품의 경우 별도 예상 배송일을 공지드립니다.</p>
                    </div>
                </div>
            </li>
            <!-- 상품2 -->
            <li th:each="qna: ${qnaList}">
                <ul class="table-content2 direct-inquiry-table-content">
                    <!-- 주문번호 -->
                    <li>
                        <p class="bold" th:text="${qna?.orderGsGroup?.orders?.oCode}">123456873131</p>
                    </li>
                    <!-- 문의유형 -->
                    <li class="inquiry-type">
                        <p class="semi-bold"><span th:text="${T(com.newper.constant.QnaType1).valueOf(qna.qnaType1).getOption()}">주문/결제확인</span> > <span th:text="${T(com.newper.constant.QnaType2).valueOf(qna.qnaType2).getOption()}">주문내역확인</span></p>
                    </li>
                    <!-- 문의제목 -->
                    <li class="inquiry-title">
                        <p class="semi-bold" th:text="${qna.qnaTitle}">배송이 언제되나요?</p>
                    </li>
                    <!-- 답변상태 -->
                    <li>
                        <!-- 답변대기-->
                        <p class="semi-bold" th:if="${qna.qnaAnswer == null}">답변대기</p>
                        <!-- 답변완료 -->
                        <p class="color-red semi-bold" th:unless="${qna.qnaAnswer == null}">답변완료</p>
                    </li>
                    <!-- 작성일 -->
                    <li>
                        <p class="bold" th:text="${qna.getDateFormatDot()}">2022.08.10</p>
                    </li>
                    <!-- 버튼 -->
                    <li class="flex-column button-vertical-group">
                        <a th:onclick="|qnaInsertModal(${qna.qnaIdx})|" class="btn btn-xs btn-point btn-width-xs radius-xlarge" th:if="${qna.qnaAnswer == null}">수정하기</a>
                        <a th:onclick="|deleteQna(${qna.qnaIdx})|" class="btn btn-xs btn-dark-gray-outline btn-width-xs radius-xlarge">삭제</a>
                    </li>
                </ul>
                <div class="inquiry-open font-md">
                    <div>
                        <div>
                            <span class="inquiry-badge font-xxsm">문의</span>
                        </div>
                        <p class="color-grey666" th:text="${qna.qnaContent}">배송 언제되는지 정확한 날짜가 알고 싶어요~~!</p>
                    </div>
                    <div th:if="${qna.qnaAnswer != null}">
                        <div>
                            <span class="inquiry-answer font-xxsm">답변</span>
                        </div>
                        <p class="color-grey666" th:text="${qna.qnaAnswer.qnaaContent}">안녕하세요 고객님!! 뉴퍼마켓을 이용해주셔서 감사합니다.<br>
                            뉴퍼마켓 직배송 상품
                            - 결제 후 1일~2일이내 발송되어 받아보시는데까지 약 2~3일 소요됩니다.
                            부득이 주문량 많아 발송이 지연되는 경우(5일 이상) 별도 안내 or 공지드리오니 안심하셔도 됩니다.<br>
                            입점업체 배송 상품
                            - 업체 사정에 따라, 결제 후 2일~3일 이내 발송되어 받아보시는데까지 약 3~4일 소요 됩니다.
                            - 단, 대형가전(TV, 냉장고, 세탁기 등), 설치상품, 주문제작상품의 경우 별도 예상 배송일을 공지드립니다.</p>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <script>
        function qnaInsertModal(qnaIdx){
            $.ajax({
                url: '/myPage/myList/qna/qnaModal.load'
                ,type:'post'
                ,data: {
                    qnaIdx : qnaIdx
                }
                ,success:function(res){

                    $('.modalContent').empty();
                    $('.modalContent').append(res);

                    $('#commonModal').show();
                }
                ,error:function(){}
            })
        }

        /**qna 삭제*/
        function deleteQna(qnaIdx) {
            if (confirm("삭제하시겠습니까?")) {
                $.ajax({
                    url: '/qna/delete/'+qnaIdx+'.ajax'
                    ,type: 'post'
                    ,success: function () {
                        openMyListQnaMenu('qnaHistory');
                    }
                });
            }
        }

        // 1:1문의 내역  클릭 시 문의내용과 답변 보이기
        $('.inquiry-title').click(function() {
            $(this).toggleClass('on');
            $(this).parent().siblings('.inquiry-open').toggle();
        });
    </script>
</th:block>
<!-- 1:1문의내역 end-->

<!-- 상품 문의내역-->
<th:block th:fragment="productQnaHistory">
    <div class="page-des">
        <p><span class="color-red">※</span>&nbsp;&nbsp;고객님께서 직접 등록하신 상품문의 내역을 조회하실 수 있습니다.</p>
        <p><span class="color-red">※</span>&nbsp;&nbsp;판매자 상품문의로 답변이 조금 지연될 수 있습니다. 처리전까지 조금만 기다려주세요! (최대 20시간 이내)</p>
    </div>

    <!-- 테이블 -->
    <div>
        <!-- 상품문의 내역 테이블 제목 -->
        <ul class="table-title2 item-inquiry-table-title font-sm">
            <li>상품명</li>
            <li>문의유형</li>
            <li>문의제목</li>
            <li>답변상태</li>
            <li>작성일</li>
            <li></li>
        </ul>
        <!-- 상품문의 내역 리스트 -->
        <ul>
            <!-- 상품 1 -->
            <li>
                <ul class="table-content2 item-inquiry-table-content">
                    <!-- 상품명 -->
                    <li class="itemName">
                        <div class="order-item-info-wrap">
                            <div>
                                <a href="javascript:;">
                                    <h3 class="font-sm bold">삼성 노트북 코어i5 램8G SSD 대용량
                                        듀얼하드 윈10</h3>
                                </a>
                            </div>
                            <div class="font-xxsm order-item-info">
                                <p>종류 : 삼성 노트북 코어 I5듀얼하드 윈 10</p>
                                <p>사이즈 : 15인치</p>
                                <p>용량 : 램 8G SSD 대용량</p>
                            </div>
                        </div>
                    </li>
                    <!-- 문의유형 -->
                    <li>
                        <p class="semi-bold">성능 및 스펙</p>
                    </li>
                    <!-- 문의제목 -->
                    <li class="inquiry-title">
                        <p class="semi-bold">성능 및 스펙</p>
                    </li>
                    <!-- 답변상태 -->
                    <li>
                        <!-- 답변대기
                        <p class="semi-bold">답변대기</p> -->
                        <!-- 답변완료 -->
                        <p class="semi-bold color-red">답변완료</p>
                    </li>
                    <!-- 작성일 -->
                    <li>
                        <p class="bold">2022.08.10</p>
                    </li>
                    <!-- 버튼 -->
                    <li class="flex-column button-vertical-group">
                        <a onclick="qspUpdateModal()" class="btn btn-xs btn-point btn-width-xs radius-xlarge">문의수정</a>
                        <a onclick="alert('준비중')" class="btn btn-xs btn-dark-gray-outline btn-width-xs radius-xlarge">삭제</a>
                    </li>
                </ul>
                <div class="inquiry-open font-md">
                    <div>
                        <div>
                            <span class="inquiry-badge font-xxsm">문의</span>
                        </div>
                        <p class="color-grey666">배송 언제되는지 정확한 날짜가 알고 싶어요~~!</p>
                    </div>
                    <div>
                        <div>
                            <span class="inquiry-answer font-xxsm">답변</span>
                        </div>
                        <p class="color-grey666">안녕하세요 고객님!! 뉴퍼마켓을 이용해주셔서 감사합니다.<br>
                            뉴퍼마켓 직배송 상품
                            - 결제 후 1일~2일이내 발송되어 받아보시는데까지 약 2~3일 소요됩니다.
                            부득이 주문량 많아 발송이 지연되는 경우(5일 이상) 별도 안내 or 공지드리오니 안심하셔도 됩니다.<br>
                            입점업체 배송 상품
                            - 업체 사정에 따라, 결제 후 2일~3일 이내 발송되어 받아보시는데까지 약 3~4일 소요 됩니다.
                            - 단, 대형가전(TV, 냉장고, 세탁기 등), 설치상품, 주문제작상품의 경우 별도 예상 배송일을 공지드립니다.</p>
                    </div>
                </div>
            </li>
            <!-- 상품 2 -->
            <li th:each="qsp: ${qnaSpList}">
                <ul class="table-content2 item-inquiry-table-content">
                    <!-- 상품명 -->
                    <li class="itemName">
                        <div class="order-item-info-wrap">
                            <div>
                                <a th:href="|shopProduct/${qsp?.shopProduct?.spIdx}|">
                                    <h3 class="font-sm bold">삼성 노트북 코어i5 램8G SSD 대용량
                                        듀얼하드 윈10</h3>
                                </a>
                            </div>
                            <div class="font-xxsm order-item-info">
                                <p>종류 : 삼성 노트북 코어 I5듀얼하드 윈 10</p>
                                <p>사이즈 : 15인치</p>
                                <p>용량 : 램 8G SSD 대용량</p>
                            </div>
                        </div>
                    </li>
                    <!-- 문의유형 -->
                    <li>
                        <p class="semi-bold" th:text="${T(com.newper.constant.QspType).valueOf(qsp?.qspType).getOption()}">성능 및 스펙</p>
                    </li>
                    <!-- 문의제목 -->
                    <li class="inquiry-title">
                        <p class="semi-bold" th:text="${qsp?.qspTitle}">성능 및 스펙</p>
                    </li>
                    <!-- 답변상태 -->
                    <li>
                        <!-- 답변대기-->
                        <p class="semi-bold" th:if="${qsp.qnaAnswer == null}">답변대기</p>
                        <!-- 답변완료 -->
                        <p class="semi-bold color-red" th:if="${qsp.qnaAnswer != null}">답변완료</p>
                    </li>
                    <!-- 작성일 -->
                    <li>
                        <p class="bold" th:text="${qsp?.getDateFormatDot()}">2022.08.10</p>
                    </li>
                    <!-- 버튼 -->
                    <li class="flex-column button-vertical-group">
                        <a onclick="qspUpdateModal()" class="btn btn-xs btn-point btn-width-xs radius-xlarge" th:if="${qsp.qnaAnswer == null}">문의수정</a>
                        <a th:onclick="|deleteQnaSp(${qsp?.qspIdx})|" class="btn btn-xs btn-dark-gray-outline btn-width-xs radius-xlarge">삭제</a>
                    </li>
                </ul>
                <div class="inquiry-open font-md">
                    <div>
                        <div>
                            <span class="inquiry-badge font-xxsm">문의</span>
                        </div>
                        <p class="color-grey666" th:text="${qsp?.qspContent}">배송 언제되는지 정확한 날짜가 알고 싶어요~~!</p>
                    </div>
                    <div th:if="${qsp.qnaAnswer != null}">
                        <div>
                            <span class="inquiry-answer font-xxsm">답변</span>
                        </div>
                        <p class="color-grey666" th:text="${qsp?.qnaAnswer?.qnaaContent}">안녕하세요 고객님!! 뉴퍼마켓을 이용해주셔서 감사합니다.<br>
                            뉴퍼마켓 직배송 상품
                            - 결제 후 1일~2일이내 발송되어 받아보시는데까지 약 2~3일 소요됩니다.
                            부득이 주문량 많아 발송이 지연되는 경우(5일 이상) 별도 안내 or 공지드리오니 안심하셔도 됩니다.<br>
                            입점업체 배송 상품
                            - 업체 사정에 따라, 결제 후 2일~3일 이내 발송되어 받아보시는데까지 약 3~4일 소요 됩니다.
                            - 단, 대형가전(TV, 냉장고, 세탁기 등), 설치상품, 주문제작상품의 경우 별도 예상 배송일을 공지드립니다.</p>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <script>
        function qspUpdateModal(){
            $.ajax({
                url: '/myPage/myList/qna/qnaProductModal.load'
                ,type:'post'
                ,success:function(res){

                    $('.modalContent').empty();
                    $('.modalContent').append(res);

                    $('#commonModal').show();
                }
                ,error:function(){}
            })
        }

        function deleteQnaSp(qspIdx) {
            if (confirm("삭제하시겠습니까?")) {
                $.ajax({
                    url: 'qna/sp/delete/'+qspIdx+'.ajax'
                    ,type: 'post'
                    ,success:function(){
                        openMyListQnaMenu('productQnaHistory');
                    }
                });
            }
        }

        // 상품문의 내역  클릭 시 문의내용과 답변 보이기
        $('.inquiry-title').click(function() {
            $(this).toggleClass('on');
            $(this).parent().siblings('.inquiry-open').toggle();
        });

    </script>
</th:block>
<!-- 상품 문의내역 end-->

<!-- 1:1문의 modal -->
<th:block th:fragment="qnaModal">
    <span th:text="${modalTitle}"></span>
    문의하기
    <form id="qnaForm" enctype="multipart/form-data">
        <table th:with="customer=${@customerRepo.findByCuId(@shopSession.getId())}">
            <tr>
                <td>문의하실 상품</td>
                <td><a onclick="openProductModal('qnaProduct')">상품 선택</a></td>
            </tr>
            <tr>
                <td>이름</td>
                <td><input type="text" name="cuName" th:value="${customer?.cuName}"></td>
            </tr>
            <tr>
                <td>이메일주소</td>
                <td>
                    <input type="text" name="email" th:value="${qna?.qnaMail != null} ? ${qna?.qnaMail.split('@')[0]}">@
                    <select name="domain">
                        <option value="">직접입력</option>
                        <option value="naver.com">naver.com</option>
                        <option value="daum.net">daum.net</option>
                        <option value="hotmail.com">hotmail.com</option>
                        <option value="nate.com">nate.com</option>
                        <option value="yahoo.co.kr">yahoo.co.kr</option>
                        <option value="paran.com">paran.com</option>
                        <option value="empas.com">empas.com</option>
                        <option value="dreamwiz.com">dreamwiz.com</option>
                        <option value="lycos.co.kr">lycos.co.kr</option>
                        <option value="korea.com">korea.com</option>
                        <option value="gmail.com">gmail.com</option>
                        <option value="hanmir.com">hanmir.com</option>
                    </select>
                    <input type="checkbox" name="qnaMailAlarm">답변알림받기
                </td>
            </tr>
            <tr>
                <td>휴대전화</td>
                <td th:with="phone=${customer?.getPhoneArr()}, qnaPhone=${qna?.getPhoneArr()}">
                    <input type="text" name="phone1" maxlength="3" th:value="${qna != null} ? ${qnaPhone[0]} : (${phone != null} ? ${phone[0]})">-
                    <input type="text" name="phone2" maxlength="4" th:value="${qna != null} ? ${qnaPhone[1]} : (${phone != null} ? ${phone[1]})">-
                    <input type="text" name="phone3" maxlength="4" th:value="${qna != null} ? ${qnaPhone[2]} : (${phone != null} ? ${phone[2]})">
                    <input type="checkbox" name="qnaPhoneAlarm">답변알림받기
                </td>
            </tr>
            <tr>
                <td>문의유형</td>
                <td>
                    <select name="qnaType1">
                        <option th:each="opt: ${T(com.newper.constant.QnaType1).values()}" th:text="${opt.option}" th:value="${opt.name()}"></option>
                    </select>
                    <select name="qnaType2">
                        <option th:each="opt: ${T(com.newper.constant.QnaType2).values()}" th:text="${opt.option}" th:value="${opt.name()}"></option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>제목</td>
                <td><input type="text" name="qnaTitle" placeholder="제목을 입력하세요." th:value="${qna?.qnaTitle}"></td>
            </tr>
            <tr>
                <td>내용작성</td>
                <td><textarea name="qnaContent" placeholder="문의하실 내용을 입력하세요." th:text="${qna?.qnaContent}"></textarea></td>
            </tr>
            <tr>
                <td>사진첨부</td>
                <td><input type="file" name="photos" accept=".jpg,.gif" multiple="multiple"></td>
            </tr>
        </table>
        <img th:if="${qna != null}" th:each="list: ${qna?.qnaJson}" th:src="${list}" />
    </form>

    <br>
    <a onclick="$('#commonModal').hide()" class="btn btn-xxlg btn-point-outline btn-width-md radius-xlarge">취소</a>
    <br>
    <a th:onclick="${qna == null} ? 'insertQna()' : 'updateQna('+${qna.qnaIdx}+')'" class="btn btn-xxlg btn-point btn-width-md radius-xlarge">작성완료</a>

    <script>
        function openProductModal(modal){
            $.ajax({
                url:'/myPage/modal/'+modal+'.load'
                ,type:'post'
                ,success:function(res){

                    $('#productModalContent').empty();
                    $('#productModalContent').append(res);

                    $('#commonModal').hide();
                    $('#productModal').show();
                }
                ,error:function(){}
            })
        }

        /** 1:1 문의 등록 */
        function insertQna() {
            if (confirm("등록하시겠습니까?")) {
                saveQna('/qna/save.ajax');
            }
        }

        /** 1:1문의 수정*/
        function updateQna(qnaIdx) {
            if (confirm("수정하시겠습니까?")) {
                saveQna('/qna/update/'+qnaIdx+'.ajax');
            }
        }

        /** 1:1 문의 등록/수정 ajax */
        function saveQna(url) {
            $.ajax({
                url: url
                ,type: 'post'
                ,processData: false
                ,contentType: false
                ,data: new FormData($('#qnaForm')[0])
                ,success: function (res) {
                    $('#commonModal').hide();
                    openMyListQnaMenu('qnaHistory');
                }
            });
        }
    </script>
</th:block>

<!-- 상품문의 수정 modal -->
<th:block th:fragment="qnaProductModal">
    <span th:text="${modalTitle}"></span>
    <form id="qspForm" enctype="multipart/form-data">
        <input type="hidden" name="spIdx" value="">

        <br>문의유형
        <div th:each="opt: ${T(com.newper.constant.QspType).values()}">
            <input type="checkbox" name="qspType" th:value="${opt.name}">
            <span th:text="${opt.getOption()}"></span>
        </div>

        제목
        <input type="text" name="qspTitle" placeholder="제목을 입력하세요."><br>

        문의내용작성
        <input type="text" name="qspContent" placeholder="내용을 입력하세요."><br>

        <!--비밀글 여부-->
        <input type="checkbox" name="qspSecret">비밀글 문의
    </form>

    <a onclick="$('#commonModal').hide()" class="btn btn-xxlg btn-point-outline btn-width-md radius-xlarge">취소</a>
    <a onclick="alert('준비중!')" class="btn btn-xxlg btn-point btn-width-md radius-xlarge">작성완료</a>
</th:block>
<!-- 상품문의 등록/수정 modal end-->
