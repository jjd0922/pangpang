<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newper.mapper.HeaderMenuMapper">

    <sql id="includeMainMenuDatatable">
        AND SHOP_IDX = #{shopIdx}
        <if test="hmName != null and hmName != ''">
            AND HM_NAME LIKE '%'||#{hmName}||'%'
        </if>
    </sql>
    <select id="selectMainMenuDatatable" resultType="map">
        SELECT
            *
        FROM (
        SELECT
            SHOP_IDX, SHOP_NAME
        FROM SHOP
        ORDER BY SHOP_IDX
        <if test="length!=-1">
            limit #{start},#{length}
        </if>
        ) SHOP LEFT JOIN HEADER_MENU ON HM_SHOP_IDX = SHOP_IDX
        <where>
            <include refid="includeMainMenuDatatable"></include>
        </where>
        ORDER BY SHOP_IDX, ABS(HM_ORDER)
    </select>
    <select id="countMainMenuDatatable" resultType="map">
        SELECT
            COUNT(DISTINCT (SHOP_IDX)) CNT
        FROM
            SHOP LEFT JOIN HEADER_MENU ON HM_SHOP_IDX = SHOP_IDX
        <where>
            <include refid="includeMainMenuDatatable"></include>
        </where>
    </select>

    <select id="countMainMenu" resultType="Integer" parameterType="Integer">
        SELECT
            COUNT(HM_IDX) CNT
        FROM
            HEADER_MENU
            ,SHOP
        WHERE
            SHOP_IDX = #{shopIdx}
    </select>
</mapper>