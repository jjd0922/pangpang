<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>배너그룹</title>
    <th:block th:replace="/common/css.html"></th:block>
</head>

<body>

<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <div class="page-header page-header-dark">
                <div class="page-header-content container-fluid header-elements-md-inline px-3">
                    <div class="d-flex">
                        <div class="page-title">
                            <h4 class="font-weight-semibold"><i class="icon-basket mr-1"></i>배너그룹</h4>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Content area -->
            <div class="content container-fluid">
                <div class="row">

                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body popup-contents">
                                <form id="popBannerForm" method="post" enctype="multipart/form-data">
                                    <fieldset class="mb-0">
                                        <legend class="">1. 배너그룹 기본정보
                                        </legend>
                                        <div class="row">
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">배너그룹명</span>
                                                        </span>
                                                        <input type="text" class="form-control" name="bgTitle" th:value="${bannerGroup?.bgTitle}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <br>
                                    <fieldset class="mb-0" id="bannerDiv">
                                        <legend class="">2. 배너등록
                                            <a onclick="addBanner()" class="btn btn-sm btn-primary ml-1">추가</a>
                                        </legend>
                                        <span class="small ml-2">
                                            ※배너 타입 "헤더형" 이미지 Width 200px Height 80px 고정
                                            <br>
                                        </span>

                                        <div class="row" th:if="${bannerGroup != null and not bannerGroup?.banners.isEmpty }" th:each="banner : ${bannerGroup?.banners}">
                                            <div class="col-sm-12 text-right" style="margin-top:20px;margin-bottom:5px;">
                                                <a class="btn btn-sm btn-danger ml-1" onclick="removeBannerDom(this)">삭제</a>
                                            </div>
                                            <div class="col-sm-12 col-md-6" style="display: none;">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">노출상태</span>
                                                        </span>
                                                        <select class="form-control select" name="bnDisplay">
                                                            <option th:value="1" th:selected="${banner.bnDisplay > 0}">노출</option>
                                                            <option th:value="-1" th:selected="${banner.bnDisplay < 0}">미노출</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">배너이미지(WEB)</span>
                                                        </span>
                                                        <input th:if="${banner.bnImage == null}" type="file" class="form-control form-control-plaintext" placeholder="파일첨부" name="bnImage" accept="image/*">
                                                        <input th:if="${banner.bnImage == null}" type="hidden" name="re_bnImage">
                                                        <div class="form-control" th:if="${banner.bnImage != null}">
                                                            <a onclick="deleteWebImage(this)" class="input-thumb-close" title="첨부 이미지 삭제">X</a>
                                                            <img th:src="${banner.bnImage}" class="input-thumb">
                                                            <input type="file" name="bnImage" accept="image/*" class="input-thumb-file">
                                                            <input type="hidden" name="re_bnImage" th:value="${banner.bnImage}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12 col-md-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">배너이미지(MOBILE)</span>
                                                        </span>
                                                        <input th:if="${banner.bnImageMobile == null}" type="file" class="form-control form-control-plaintext" placeholder="파일첨부" name="bnImageMobile" accept="image/*">
                                                        <input th:if="${banner.bnImageMobile == null}" type="hidden" name="re_bnImageMobile">
                                                        <div class="form-control" th:if="${banner.bnImageMobile != null}">
                                                            <a onclick="deleteMobImage(this)" class="input-thumb-close" title="첨부 이미지 삭제">X</a>
                                                            <img th:src="${banner.bnImageMobile}" class="input-thumb">
                                                            <input type="file" name="bnImageMobile" accept="image/*" class="input-thumb-file">
                                                            <input type="hidden" name="re_bnImageMobile" th:value="${banner.bnImageMobile}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12 col-md-12">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <span class="input-group-prepend">
                                                            <span class="input-group-text">링크(URL)</span>
                                                        </span>
                                                        <input class="form-control" type="text" name="bnUrl" th:value="${banner.bnUrl}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </fieldset>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- /content area -->

        </div>
        <!-- /inner content -->

    </div>
    <!-- /main content -->

</div>

<div class="navbar navbar-expand-lg navbar-dark">
    <div class=" w-100 text-right mt-1 mb-1">
        <button type="button" class="btn btn-sm btn-light float-left" onclick="window.close();"><i class="icon-cross2 mr-1"></i>닫기</button>
        <button type="button" class="btn btn-sm btn-secondary" onclick="newBanner()"><i class="icon-floppy-disk mr-1"></i>저장</button>
    </div>
</div>

<div style="display:none;" id="bannerDom">
    <!-- 배너 dom-->
    <div class="row">
        <div class="col-sm-12 text-right" style="margin-top:20px;margin-bottom:5px;">
            <a class="btn btn-sm btn-danger ml-1" onclick="removeBannerDom(this)">삭제</a>
        </div>
        <div class="col-sm-12 col-md-6" style="display: none;">
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-prepend">
                        <span class="input-group-text">노출상태</span>
                    </span>
                    <select class="form-control" name="bnDisplay">
                        <option th:value="1">노출</option>
                        <option th:value="-1">미노출</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-6">
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-prepend">
                        <span class="input-group-text">배너이미지(WEB)</span>
                    </span>
                    <input class="form-control form-control-plaintext" placeholder="파일첨부" type="file" name="bnImage" accept="image/*">
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-6">
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-prepend">
                        <span class="input-group-text">배너이미지(MOBILE)</span>
                    </span>
                    <input class="form-control form-control-plaintext" placeholder="파일첨부" type="file" name="bnImageMobile" accept="image/*">
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-12">
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-prepend">
                        <span class="input-group-text">링크(URL)</span>
                    </span>
                    <input class="form-control" type="text" name="bnUrl">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 공통 js -->
<script th:src="@{/assets/js/main/jquery.min.js}"></script>
<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<!-- 첨부이미지 hover 미리보기 -->
<script language="JavaScript">
    $(document).ready(function() {
        var xOffset = 150;
        var yOffset = -10;

        $(document).on("mouseover",".input-thumb",function(e){
            var image_data = $(this).data("image");
            var add_caption = (image_data != undefined) ? "<br/>" + image_data : "" ;
            $("body").append("<p id='preview' class='input-thumb-preview'><img src='"+ $(this).attr("src") +"' width='100%' />"+ add_caption +"</p>");
            $("#preview")
                .css("left",(e.clientX - xOffset) + "px")
                .css("top",(e.clientY - yOffset) + "px")
                .fadeIn("fast");
        });

        $(document).on("mousemove",".input-thumb",function(e){
            $("#preview")
                .css("left",(e.clientX - xOffset) + "px")
                .css("top",(e.clientY - yOffset) + "px");
        });

        $(document).on("mouseout",".input-thumb",function(){
            $("#preview").remove();
        });
    });
</script>

</body>

<th:block th:replace="/modal/shopModal.html"/>
<script th:inline="javascript">
    //배너 그룹 저장
    function newBanner(){
        if($('input[name="shopIdx"]').val() == ''){
            alert('분양몰을 선택해주세요.');
            return false;
        }
        if(window.confirm('저장 하시겠습니까?')){
            $('#popBannerForm').submit();
        }
    }

    //배너 추가
    function addBanner(){
        $('#bannerDiv').append($('#bannerDom').clone().html());

        $('#popBannerForm select[name=bnDisplay]').select2({
            minimumResultsForSearch: Infinity
        });
    }
    //배너 삭제
    function removeBannerDom(obj){
        if([[${bannerGroup?.bgIdx}]] != null){
            if(window.confirm('배너를 삭제하시겠습니까? \n 설정 후 아래 *저장 버튼을 눌러야 DB에 반영됩니다.')){
                $($(obj).parents('.row')[0]).remove();
            }
        }else{
            $($(obj).parents('.row')[0]).remove();
        }
    }

</script>
<script th:inline="javascript">
    window.onload=function(){
    }
</script>
</html>
