<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>HOME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <th:block th:replace="common/css.html"></th:block>
</head>
<body>
<th:block th:replace="common/header.html"></th:block>

<!-- 본문 영역 시작 -->
<div class="page-content">
  <div class="content-wrapper">
    <div class="content-inner">

      <!-- Content area -->
      <div class="content container-fluid">
        <div class="row">
          <div class="col-lg-12">

            <div class="card">
              <div class="card-header header-elements-inline">
                <h6 class="card-title">
                  <div class="breadcrumb breadcrumb-caret">
                  </div>
                </h6>
                <div class="header-elements text-right">
                  <div class="d-inline-block d-md-flex d-md-flex-row justify-content-between">
                    <div class="list-icons ml-2">
                      <a class="list-icons-item" data-action="collapse"></a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="collapse show" id="collapse-button-collapsed">
                <div class="card-body pt-0">
                  <form id="searchForm" onkeypress="if(event.keyCode==13){searchBtn();return false;}">
                    <div class="row">
                      <div class="col-lg-12 d-flex justify-content-center align-content-end align-items-end flex-wrap">

                        <div class="form-group end">
                          <button type="button" class="btn btn-secondary" onclick="searchBtn()">
                            <span class="ladda-label"><i class="icon-search4 mr-1"></i>조회하기</span>
                          </button>
                        </div>

                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 카드 2열 레이아웃 -->
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header bg-white header-elements-inline justify-content-start">
                <h6 class="card-title" th:text="${subTitle}"></h6>
                <a class="btn btn-sm btn-primary ml-1" onclick="shopNewPop()">신규등록</a>
                <a class="btn btn-sm btn-primary ml-1" onclick="deleteAllShop()">일괄 삭제</a>
              </div>

              <table class="table" id="shopTable"></table>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>

<!-- 공통 js -->

<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<!-- input -->
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>

<script th:src="@{/assets/js/common.js}"></script>

<script>
  function searchBtn(){
    $('#shopTable').DataTable().page('first').ajax.url('/shop/shop.dataTable?' + $('#searchForm').serialize()).load(null, false);
  }
  //분양몰 상세 팝업
  function shopDetailPop(idx) {
      var focusPopup = window.open('/shop/' + idx, 'shopDetail', 'width=1000, height=800, scrollbars=yes, resizable=yes');
      focusPopup.focus();
  }
  //분양몰 신규 팝업
  function shopNewPop(){
      var focusPopup = window.open('/shop/new', 'shopNew', 'width=1000, height=800, scrollbars=yes, resizable=yes');
      focusPopup.focus();
  }
  //분양몰 디자인관리 팝업
  function updateDesignPop(shopIdx){
    var focusPopup = window.open('/shop/pop/design/'+shopIdx, 'shopDesign', 'width=1000, height=800, scrollbars=yes, resizable=yes');
    focusPopup.focus();
  }
  // 분양몰 일괄변경
  function deleteAllShop(){
    var param = dataTableGetSelectedDataArray('shopTable', 'SHOP_IDX');
    var state = dataTableGetSelectedDataArray('shopTable', 'SHOP_STATE');

    if(param.length == 0){
      alert('선택된 내역이 없습니다.');
      return false;
    }else{
      if(window.confirm('분양몰을 삭제하시겠습니까?')){
        $.ajax({
          url:'/shop/delete.ajax',
          type: 'post',
          data: {
            shopIdxs: param,
            states: state
        },
        success: function(res){
          $('#shopTable').DataTable().ajax.reload();
        },
        error: function(){
        }
      });
      }
    }
  }
</script>
<script>
  $('#shopTable').DataTable({
    dom: '<"datatable-header"Bip><"datatable-scroll"t>',
    select: {
      style: 'multi',
      selector: 'td:first-child'
    },
    columnDefs: [ {
      orderable: false,
      targets:   [0]
    } ],
    ordering: false,
    serverSide: true,
    ajax:{
      url:'/shop/shop.dataTable?'+$('#searchForm').serialize(),
      type:'post'
    },
    "columns" : [
      {'class':'select-checkbox m-w-2', 'title':'선택','data':'SHOP_IDX','render': function(data,type,full,meta){
        return '';
      }},
      {'title':'No','data':'No','render':function(data,type,full,meta){
        return meta.settings._iDisplayStart+meta.row+1;
      }}
      ,{'title':'분양몰코드','data':'SHOP_IDX', 'defaultContent':''}
      ,{'title':'분양몰명','data':'SHOP_NAME','defaultContent':'', 'render':function(data,type,full,meta){
        return '<a class="btn btn-sm btn-primary" onClick="shopDetailPop('+full.SHOP_IDX+')">'+ellipsisStr(full.SHOP_NAME)+'</a>';
      }}
      ,{'title':'디자인설정','data':'SHOP_IDX', 'defaultContent':'', 'render':function(data,type,full,meta){
        return '<a class="btn btn-sm btn-primary" onClick="updateDesignPop('+full.SHOP_IDX+')">관리</a>';
      }}
      ,{'title':'운영 상태','data':'SHOP_STATE_STR', 'defaultContent':''}
      ,{'title':'분양몰 타입','data':'SHOP_TYPE_STR', 'defaultContent':''}
      ,{'title':'분양몰 등록일','data':'CREATED_DATE_TIME', 'defaultContent':''}
      // ,{'title':'등록시간','data':'CREATED_TIME', 'defaultContent':''}
    ]
  });
</script>
</html>