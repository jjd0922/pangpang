<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${product != null} ? 'SHOP 상품 조회/수정':'SHOP 상품 등록'"></title>

    <th:block th:replace="common/css.html"></th:block>
    <style>
        .modal-dialog{
            max-width: 950px;
        }

        .table-hover {
            width: 100% !important;
        }
    </style>
</head>

<body>
<!-- 본문 영역 시작 -->
<div class="page-content">
    <div class="content-wrapper">
        <div class="content-inner">
            <div class="page-header page-header-dark">
                <div class="page-header-content container-fluid header-elements-md-inline px-3">
                    <div class="d-flex">
                        <div class="page-title">
                            <h4 class="font-weight-semibold" >SHOP 상품 등록</h4>
                        </div>
                    </div>
                </div>
            </div>
            <form id="productForm">
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>1.SHOP 상품 등록정보<span class="small ml-2"></span></legend>
                            <div class="row">
                                <!-- 입력필드 -->
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                SHOP 상품코드
                                            </span>
                                        </span>
                                            <input type="text" name="SP_CODE" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text requested">
                                                SHOP 상품명
                                            </span>
                                        </span>
                                            <input type="text" name="SP_NAME" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text requested">
                                                판매 SHOP
                                                &nbsp;<a class="btn btn-sm badge-indigo legitRipple" onclick="showShopModal()">검색</a>
                                            </span>
                                        </span>
                                            <input type="text" name="SHOP_NAME" class="form-control" readonly>
                                            <input type="hidden" name="SP_SHOP_IDX">
                                            <input type="hidden" id="checkProduct" value="false">
                                            <input type="hidden" name="SP_CATE_IDX">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text requested">
                                                SHOP 판매상태
                                            </span>
                                        </span>
                                            <select class="form-control select" data-placeholder="선택" name="SP_STATE">
                                                <option th:each="opt: ${T(com.newper.constant.SpState).values()}" th:text="${opt.option}" th:value="${opt.name()}"></option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                SHOP 판매기간 시작일
                                            </span>
                                        </span>
                                            <input type="text" name="SP_SELL_START_DATE" class="form-control daterange-singlenull" readonly>
                                            <input type="time" name="SP_SELL_START_TIME" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                SHOP 판매기간 종료일
                                            </span>
                                        </span>
                                            <input type="text" name="SP_SELL_END_DATE" class="form-control daterange-singlenull" readonly>
                                            <input type="time" name="SP_SELL_END_TIME" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                전시 대분류
                                            </span>
                                        </span>
                                            <select class="form-control select " data-placeholder="선택" name="P_CATE_IDX2">
                                                <option></option>
                                                <option th:each="shopCategory:${shopCategory}" th:text="${shopCategory.SCATE_NAME}" th:value="${shopCategory.SCATE_IDX}" th:selected="${product?.shopCategory?.scateIdx == shopCategory.SCATE_IDX}"></option>
                                            </select>
                                        </div>
                                    </div>
                                </div>-->
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                SHOP 노출기간 시작일
                                            </span>
                                        </span>
                                            <input type="text" name="SP_SHOW_START_DATE" class="form-control daterange-singlenull" readonly>
                                            <input type="time" name="SP_SHOW_START_TIME" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-text">
                                                SHOP 노출기간 종료일
                                            </span>
                                        </span>
                                            <input type="text" name="SP_SHOW_END_DATE" class="form-control daterange-singlenull" readonly>
                                            <input type="time" name="SP_SHOW_END_TIME" class="form-control">
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>2.SHOP상품 관리정보<span class="small ml-2"></span></legend>
                            <div class="row">
                                <!-- 입력필드 -->
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    썸네일1
                                                </span>
                                            </span>
                                            <div class="form-control">
                                                <img th:if="${product}!=null" th:src="${product?.pThumbFile1}" class="input-thumb">
                                                <img th:unless="${product}!=null" class="input-thumb" id="THUMB_FILE1">
                                                <input type="file" name="SP_THUMB_FILE1" accept="image/*" class="input-thumb-file">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    썸네일2
                                                </span>
                                            </span>
                                            <div class="form-control">
                                                <img th:if="${product}!=null" th:src="${product?.pThumbFile2}" class="input-thumb">
                                                <img th:unless="${product}!=null" class="input-thumb" id="THUMB_FILE2">
                                                <input type="file" name="SP_THUMB_FILE2" accept="image/*" class="input-thumb-file">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    썸네일3
                                                </span>
                                            </span>
                                            <div class="form-control">
                                                <img th:if="${product}!=null" th:src="${product?.pThumbFile3}" class="input-thumb">
                                                <img th:unless="${product}!=null" class="input-thumb" id="THUMB_FILE3">
                                                <input type="file" name="SP_THUMB_FILE3" accept="image/*" class="input-thumb-file">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <br>
                        <fieldset class="mb-0">
                            <span class="input-group-text w-100 mb--1">상세이미지</span>
                            <textarea id="summerNote1" name="SP_INFO" th:text="${info}"></textarea>
                            <span class="input-group-text w-100 mb--1">MD 상품평</span>
                            <textarea id="summerNote2" name="SP_MD" th:text="${md}"></textarea>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>3.가격정보<span class="small ml-2"></span></legend>
                            <div class="row">
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">기준판매가(상품) 합</span>
                                            </span>
                                            <input type="text" name="SP_P_SELL_PRICE_SUM" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-prepend">
                                        <span class="input-group-text">기준판매가(재고) 합</span>
                                    </span>
                                            <input type="text" name="SP_GS_PRICE_SUM" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-prepend">
                                        <span class="input-group-text">SHOP 판매가(뉴퍼마켓가) 합</span>
                                    </span>
                                            <input type="text" name="SP_SPO_SHOP_PRICE_SUM" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-prepend">
                                        <span class="input-group-text">할인가 합</span>
                                    </span>
                                            <input type="text" name="SP_SPO_PRICE_SUM" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-prepend">
                                        <span class="input-group-text">네이버최저가의 합</span>
                                    </span>
                                            <input type="text" name="SP_NAVER_SUM" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-prepend">
                                        <span class="input-group-text">유통가의 합</span>
                                    </span>
                                            <input type="text" name="SP_RETAIL_PRICE" class="form-control text-right" value="0" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>4.재고상품 구성<span class="small ml-2"></span>
                                <a class="btn btn-sm badge-indigo" onclick="essentialAdd()">필수상품 추가</a>
                                <a class="btn btn-sm badge-indigo" onclick="chooseAdd()">선택상품 추가</a>
                                <input type="hidden" id="essentialCnt" value="1">
                                <input type="hidden" id="chooseAddCnt" value="1">
                            </legend>
                            <div class="row" id="essential">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-text w-100 mb--1">
                                        4-1. 필수상품
                                        <a class="btn btn-sm badge-indigo" onclick="">판매가 저장</a>
                                    </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="form-control">
                                                1번 필수상품
                                                <a class="btn btn-sm badge-indigo" onclick="showGoodsStockModal(1,true)">재고상품 검색</a>
                                            </span>
                                        </div>
                                    </div>
                                    <table class="table table-bordered" id="essentialTable1">
                                        <thead>
                                        <tr class="alpha-brown text-bold">
                                            <th>상품코드</th>
                                            <th>상품명</th>
                                            <th>모델명</th>
                                            <th>재고코드</th>
                                            <th>재고상품명</th>
                                            <th>등급</th>
                                            <th>옵션1</th>
                                            <th>옵션2</th>
                                            <th>옵션3</th>
                                            <th>스펙</th>
                                            <th>기준매입원가</th>
                                            <th>네이버최저가</th>
                                            <th>유통가</th>
                                            <th>기준판매가(상품)</th>
                                            <th>기준판매가(재고)</th>
                                            <th>SHOP 판매가(뉴퍼마켓가)</th>
                                            <th>할인가(최종혜택가)</th>
                                            <th>재고자산</th>
                                            <th>삭제</th>
                                        </tr>
                                        </thead>
                                        <input type="hidden" id="eaCnt1" value="0">
                                        <tbody id="essential_area1">
                                        </tbody>
                                    </table>
                                    <div class="form-group">
                                        <div class="input-group" id="essentialAdd1">
                                            <span class="form-control">
                                                1번 종속상품
                                                <a class="btn btn-sm badge-indigo" onclick="showEssentialAdd(1)">종속상품 검색</a>
                                            </span>
                                        </div>
                                    </div>
                                    <br>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="alpha-brown text-bold">
                                                <th>상품코드</th>
                                                <th>상품명</th>
                                                <th>모델명</th>
                                                <th>재고코드</th>
                                                <th>재고상품명</th>
                                                <th>등급</th>
                                                <th>옵션1</th>
                                                <th>옵션2</th>
                                                <th>옵션3</th>
                                                <th>스펙</th>
                                                <th>기준매입원가</th>
                                                <th>네이버최저가</th>
                                                <th>유통가</th>
                                                <th>기준판매가(상품)</th>
                                                <th>기준판매가(재고)</th>
                                                <th>SHOP 판매가(뉴퍼마켓가)</th>
                                                <th>삭제</th>
                                            </tr>
                                        </thead>
                                        <input type="hidden" id="essentialAddCnt1" value="0">
                                        <tbody id="essentialAddBody1">
                                        </tbody>
                                    </table>
                                    <div class="form-group">
                                    </div>
                                </div>
                            </div>
                            <br>
                        </fieldset>
                        <fieldset class="mb-0">
                            <div class="row" id="choose">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-text w-100 mb--1">
                                        4-2 추가(선택)상품
                                        <a class="btn btn-sm badge-indigo" onclick="">판매가 저장</a>
                                        <input type="hidden" id="chooseCnt1" value="0">
                                    </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="form-control">
                                        1번 선택상품
                                        <a class="btn btn-sm badge-indigo legitRipple" onclick="showGoodsStockModal(1,false)">재고상품 검색</a>
                                    </span>
                                        </div>
                                    </div>
                                    <table class="table table-bordered">
                                        <thead id="choose_head">
                                        <tr class="alpha-brown text-bold">
                                            <th>상품코드</th>
                                            <th>상품명</th>
                                            <th>모델명</th>
                                            <th>재고코드</th>
                                            <th>재고상품명</th>
                                            <th>등급</th>
                                            <th>옵션1</th>
                                            <th>옵션2</th>
                                            <th>옵션3</th>
                                            <th>스펙</th>
                                            <th>기준매입원가</th>
                                            <th>네이버최저가</th>
                                            <th>유통가</th>
                                            <th>기준판매가(상품)</th>
                                            <th>기준판매가(재고)</th>
                                            <th>SHOP 판매가(뉴퍼마켓가)</th>
                                            <th>할인가(최종혜택가)</th>
                                            <th>재고자산</th>
                                            <th>삭제</th>
                                        </tr>
                                        </thead>
                                        <tbody id="choose_area">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>5.리뷰정보<span class="small ml-2"></span></legend>
                            <div class="row">
                                <!-- 입력필드 -->
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    조회수
                                                </span>
                                            </span>
                                        </span>
                                            <input type="text" name="" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    관심받은 수
                                                </span>
                                            </span>
                                        </span>
                                            <input type="text" name="" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    상품문의수
                                                </span>
                                            </span>
                                        </span>
                                            <input type="text" name="" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                        <span class="input-group-prepend">
                                            <span class="input-group-prepend">
                                                <span class="input-group-text">
                                                    상품평 수
                                                </span>
                                            </span>
                                        </span>
                                            <input type="text" name="" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>6.SHOP상품 제어항목<span class="small ml-2"></span></legend>
                            <div class="row">
                                <!-- 입력필드 -->
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        부적격상품
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_ELIGIBLE">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        할인율제외
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_DISCOUNT">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        딱지이미지1 사용여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_IMAGE1">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        딱지이미지2 사용여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_IMAGE2">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        딱지이미지3 사용여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_IMAGE3">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        구매 최대수량(1회 최대구매 수량)
                                                    </span>
                                                </span>
                                            </span>
                                            <input type="text" name="SP_QUOTA_ONCE" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        아이디당 구매제한(전체기간)
                                                    </span>
                                                </span>
                                            </span>
                                            <input type="text" name="SP_QUOTA_ID" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        최소 주문수량
                                                    </span>
                                                </span>
                                            </span>
                                            <input type="text" name="SP_MINIMUM" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        마일리지 사용제한 여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_USE_MILEAGE">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        앱전용상품 여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_ONLY_APP">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        네이버최저가/유통가
                                                    </span>
                                                </span>
                                            </span>
                                            <input type="text" name="SP_NAVER_PRICE" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        네이버최저가 리미트
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_NAVER_LIMIT">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-prepend">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        할인쿠폰 사용제한 여부
                                                    </span>
                                                </span>
                                            </span>
                                            <select class="form-control select " data-placeholder="선택" name="SP_USE_COUPON">
                                                <option></option>
                                                <option>Y</option>
                                                <option>N</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body popup-contents">
                        <fieldset class="mb-0">
                            <legend>7.관련상품<span class="small ml-2"></span></legend>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="input-group-text w-100 mb--1">
                                        관련 SHOP 상품
                                    </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
                                    <span class="form-control">
                                        <a class="btn btn-sm badge-indigo" onclick="">SHOP상품 검색</a>
                                    </span>
                                        </div>
                                    </div>
                                    <table class="table table-bordered">
                                        <thead id="related_head">
                                        <tr class="alpha-brown text-bold">
                                            <th>NO</th>
                                            <th>SHOP상품코드</th>
                                            <th>SHOP상품명</th>
                                            <th>SHOP판매가(뉴퍼마켓가)의 합</th>
                                            <th>할인가의 합</th>
                                            <th>삭제</th>
                                        </tr>
                                        </thead>
                                        <tbody id="related_area">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </form>
            <div class="navbar navbar-dark border-bottom-0 border-top d-flex justify-content-between py-2">
                <button type="button" class="btn btn-sm btn-light float-left" onclick="window.close();"><i class="icon-cross2 mr-1"></i>닫기</button>
                <button th:if="${product}==null" onclick="saveShopProduct()" type="button" class="btn btn-sm btn-secondary ml-1" ><i class="icon-floppy-disk mr-1"></i>저장</button>
                <button th:unless="${product}==null" onclick="" type="button" class="btn btn-sm btn-secondary ml-1" ><i class="icon-floppy-disk mr-1"></i>수정</button>
            </div>
        </div>
    </div>
</div>
<th:block th:replace="product/modal/shopModal.html"/>
<th:block th:replace="product/modal/goodsStockModal.html"/>

<!-- 공통 js -->

<script th:src="@{/assets/js/main/bootstrap.bundle.min.js}"></script>

<!-- 맞춤 js -->
<script th:src="@{/assets/js/app.js}"></script>
<script th:src="@{/assets/js/common.js}"></script>

<!-- input -->
<script th:src="@{/assets/js/plugins/ui/moment/moment.min.js}"></script>
<script th:src="@{/assets/js/plugins/extensions/jquery_ui/interactions.min.js}"></script>
<script th:src="@{/assets/js/plugins/forms/selects/select2.min.js}"></script>
<script th:src="@{/assets/js/plugins/pickers/daterangepicker.js}"></script>
<script th:src="@{/assets/js/demo_pages/form_select2.js}"></script>
<script th:src="@{/assets/js/demo_pages/picker_date.js}"></script>

<!-- 데이터테이블 -->
<script th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/select.min.js}"></script>
<script th:src="@{/assets/js/plugins/tables/datatables/extensions/buttons.min.js}"></script>

<!-- 드래그&드랍 -->
<script th:src="@{/assets/js/demo_pages/extension_dnd.js}"></script>
<script th:src="@{/assets/js/plugins/ui/dragula.min.js}"></script>

<!-- 멀티 선택 (숫자) -->
<script th:src="@{/assets/js/plugins/forms/selects/bootstrap_multiselect.js}"></script>
<script th:src="@{/assets/js/demo_pages/form_multiselect.js}"></script>

<!-- 에디터 -->
<script th:src="@{/assets/js/plugins/editors/summernote/summernote.min.js}"></script>
<script th:src="@{/assets/js/plugins/editors/summernote/lang/summernote-ko-KR.js}"></script>

<!-- 에디터 -->
<script th:src="@{/assets/js/demo_pages/editor_summernote.js}"></script>
<!-- 메뉴 호버 -->
<script th:src="@{/assets/js/plugins/buttons/hover_dropdown.min.js}"></script>
</body>


<th:block th:replace="modal/summernoteImageModal.html"></th:block>

<script th:inline="javascript">

    function selectShop(row){
        var rowData = getDatatablemap('shopModalTable', row);
        $('#searchShopModal').modal('hide');
        $('input[name="SHOP_NAME"]').val(rowData.SHOP_NAME);
        $('input[name="SP_SHOP_IDX"]').val(rowData.SHOP_IDX);
    }



    function essentialAdd(){
        var essentialCnt = $('#essentialCnt').val();
        if(essentialCnt==3){
            alert("필수상품은 최대 3개까지 구성할 수 있습니다.");
            return false;
        }
        essentialCnt++;
        $('#essentialCnt').val(essentialCnt);
        var str = '';
        str += '<div class="col-sm-12"><div class="form-group"><div class="input-group">';
        str += '<span class="form-control">'+essentialCnt+'번 필수상품<a class="btn btn-sm badge-indigo" onclick="showGoodsStockModal('+essentialCnt+','+true+')">재고상품 검색</a></span></div></div>';
        str += '<table class="table table-bordered" id="essentialTable'+essentialCnt+'"><thead><tr class="alpha-brown text-bold">';
        str += '<th>상품코드</th><th>상품명</th><th>모델명</th><th>재고코드</th><th>재고상품명</th><th>등급</th><th>옵션1</th><th>옵션2</th><th>옵션3</th><th>스펙</th>';
        str += '<th>기준매입원가</th><th>네이버최저가</th><th>유통가</th><th>기준판매가(상품)</th><th>기준판매가(재고)</th><th>SHOP 판매가(뉴퍼마켓가)</th><th>할인가(최종혜택가)</th><th>재고자산</th><th>삭제</th></tr>'
        str += '</thead><input type="hidden" id="eaCnt'+essentialCnt+'" value="0"><tbody id="essential_area'+essentialCnt+'"></tbody></table><div class="form-group"><div class="input-group" id="essentialAdd'+essentialCnt+'"><span class="form-control">'+essentialCnt+'번 종속상품<a class="btn btn-sm badge-indigo" onclick="showEssentialAdd('+essentialCnt+')">종속상품 검색</a></span></div></div>'
        str += '<br><table class="table table-bordered"><thead><tr class="alpha-brown text-bold"><th>NO</th><th>상품코드</th><th>상품명</th><th>모델명</th><th>재고코드</th><th>재고상품명</th><th>등급</th><th>옵션1</th><th>옵션2</th><th>옵션3</th><th>스펙</th><th>기준매입원가</th><th>네이버최저가</th><th>유통가</th><th>기준판매가(상품)</th><th>기준판매가(재고)</th><th>SHOP 판매가(뉴퍼마켓가)</th><th>삭제</th></tr></thead><input type="hidden" id="essentialAddCnt'+essentialCnt+'" value="0"><tbody id="essentialAddBody'+essentialCnt+'"></tbody></table><div class="form-group"></div></div>'
        $('#essential').append(str);
    }

    function chooseAdd(){
        var chooseAddCnt = $('#chooseAddCnt').val();
        if(chooseAddCnt==3){
            alert("선택상품은 최대 3개까지 구성할 수 있습니다.");
            return false;
        }
        chooseAddCnt++;
        $('#chooseAddCnt').val(chooseAddCnt);
        var str = '';
        str += '<div class="col-sm-12"><div class="form-group"><div class="input-group">';
        str += '<span class="form-control">'+chooseAddCnt+'번 선택상품<a class="btn btn-sm badge-indigo" onclick="showGoodsStockModal('+essentialCnt+','+false+')">재고상품 검색</a></span></div></div>';
        str += '<table class="table table-bordered" id="essentialTable'+essentialCnt+'"><thead><tr class="alpha-brown text-bold">';
        str += '<th>상품코드</th><th>상품명</th><th>모델명</th><th>재고코드</th><th>재고상품명</th><th>등급</th><th>옵션1</th><th>옵션2</th><th>옵션3</th><th>스펙</th>';
        str += '<th>기준매입원가</th><th>네이버최저가</th><th>유통가</th><th>기준판매가(상품)</th><th>기준판매가(재고)</th><th>SHOP 판매가(뉴퍼마켓가)</th><th>할인가(최종혜택가)</th><th>재고자산</th><th>삭제</th></tr>'
        str += '</thead><input type="hidden" id="eaCnt'+essentialCnt+'" value="0"><tbody id="essential_area'+essentialCnt+'"></tbody></table></div>'
        $('#choose').append(str);

    }

    function selectProduct(cnt,boolean){
        var row=$('#goodsStockModalTable').DataTable().rows({selected:true})[0];
        var checkProduct = $('#checkProduct').val();
        if(boolean){
            for(var i=0;i<row.length;i++){
                var rowData = getDatatablemap('goodsStockModalTable', row[i]);
                if(!($('#GS_IDX'+cnt+'-'+rowData.GS_IDX).length>0)){
                    var eaCnt = $('#eaCnt'+cnt).val();
                    eaCnt++;
                    $('#eaCnt'+cnt).val(eaCnt);
                    var str = '';
                    str += '<tr id="essentialTr'+cnt+'-'+eaCnt+'"><td>'+rowData.P_IDX+'</td><td>'+rowData.P_NAME+'</td><td>'+rowData.P_MODEL+'</td><td>'+rowData.GS_CODE+'</td><td>'+rowData.GS_NAME+'</td>';
                    str += '<td>'+rowData.GS_RANK+'</td><td>'+rowData.OPTION1+'</td><td>'+rowData.OPTION2+'</td><td>'+rowData.OPTION3+'</td><td>'+rowData.SPEC_LOOKUP+'</td><td>'+comma(rowData.P_COST)+'</td>'
                    str += '<td>'+comma(rowData.NAVER)+'</td><td>'+comma(rowData.P_RETAIL_PRICE)+'</td><td>'+comma(rowData.P_SELL_PRICE)+'</td><td>'+comma(rowData.GS_PRICE)+'</td>'
                    str += '<td><input type="text" class="form-control text-right" name="SPO_MONEY'+cnt+'-'+rowData.GS_IDX+'" onkeyup="numCommaKeyUp();sumSpoMoney();" value="'+comma(rowData.GS_PRICE)+'"></td>'
                    str += '<td><input type="text" class="form-control text-right" name="SPO_DISCOUNT'+cnt+'-'+rowData.GS_IDX+'" onkeyup="numCommaKeyUp();sumSpoDiscount();" value="'+comma(rowData.GS_PRICE)+'"><input type="hidden" name="GS_IDX'+cnt+'-'+rowData.GS_IDX+'" id="GS_IDX'+cnt+'-'+rowData.GS_IDX+'" value="'+rowData.GS_IDX+'"></td>'
                    str += '<td>'+rowData.cnt+'</td>'
                    str += '<td><button onclick="deleteGoodsStock('+cnt+','+eaCnt+')" class="btn btn-sm btn-secondary ml-1">삭제</button></td>'
                    $('#essential_area'+cnt).append(str);

                    if(cnt==1&&i==0){
                        if(checkProduct=='false'){
                            $('input[name="SP_CATE_IDX"]').val(rowData.CATE_IDX)
                            if(rowData.GS_THUMB_FILE1!=''){
                                $('#THUMB_FILE1').attr("src",rowData.GS_THUMB_FILE1);
                            }
                            if(rowData.GS_THUMB_FILE2!=''){
                                $('#THUMB_FILE2').attr("src",rowData.GS_THUMB_FILE2);
                            }
                            if(rowData.GS_THUMB_FILE3!=''){
                                $('#THUMB_FILE3').attr("src",rowData.GS_THUMB_FILE3);
                            }
                            $('#summerNote1').summernote('code',summernoteContent(rowData.GS_CONTENT));

                            $('#checkProduct').val('true');
                        }
                    }

                }

            }
            sumSpoMoney();
            sumSpoDiscount();
        }else{
            for(var i=0;i<row.length;i++){
                var rowData = getDatatablemap('goodsStockModalTable', row[i]);
                if(!($('#GS_IDX_NO'+cnt+'-'+rowData.GS_IDX).length>0)){
                    var eaCnt = $('#chooseCnt'+cnt).val();
                    eaCnt++;
                    $('#chooseCnt'+cnt).val(eaCnt);
                    var str = '';
                    str += '<tr id="chooseTr'+cnt+'-'+eaCnt+'"><td>'+rowData.P_IDX+'</td><td>'+rowData.P_NAME+'</td><td>'+rowData.P_MODEL+'</td><td>'+rowData.GS_CODE+'</td><td>'+rowData.GS_NAME+'</td>';
                    str += '<td>'+rowData.GS_RANK+'</td><td>'+rowData.OPTION1+'</td><td>'+rowData.OPTION2+'</td><td>'+rowData.OPTION3+'</td><td>'+rowData.SPEC_LOOKUP+'</td><td>'+comma(rowData.P_COST)+'</td>'
                    str += '<td>'+comma(rowData.NAVER)+'</td><td>'+comma(rowData.P_RETAIL_PRICE)+'</td><td>'+comma(rowData.P_SELL_PRICE)+'</td><td>'+comma(rowData.GS_PRICE)+'</td>'
                    str += '<td><input type="text" class="form-control text-right" name="SPO_MONEY_NO'+cnt+'-'+rowData.GS_IDX+'" onkeyup="numCommaKeyUp()" value="'+comma(rowData.GS_PRICE)+'"></td>'
                    str += '<td><input type="text" class="form-control text-right" name="SPO_DISCOUNT_NO'+cnt+'-'+rowData.GS_IDX+'" onkeyup="numCommaKeyUp()" value="'+comma(rowData.GS_PRICE)+'"><input type="hidden" name="GS_IDX_NO'+cnt+'-'+rowData.GS_IDX+'" id="GS_IDX_NO'+cnt+'-'+rowData.GS_IDX+'" value="'+rowData.GS_IDX+'"></td>'
                    str += '<td>'+rowData.cnt+'</td>'
                    str += '<td><button onclick="deleteChooseGoodsStock('+cnt+','+eaCnt+')" class="btn btn-sm btn-secondary ml-1">삭제</button></td>'
                    $('#choose_area').append(str);
                }
            }
        }
        $('#searchGoodsStockModal').modal('hide');

    }

    function deleteGoodsStock(cnt,eaCnt) {
        $('#essentialTr'+cnt+'-'+eaCnt).remove();
    }

    function deleteChooseGoodsStock(cnt,eaCnt){
        $('#chooseTr'+cnt+'-'+eaCnt).remove();
    }

    function selectEssentialAdd(cnt){
        var row=$('#goodsStockModalTable').DataTable().rows({selected:true})[0];
        for(var i=0;i<row.length;i++){
            var rowData = getDatatablemap('goodsStockModalTable', row[i]);
            var eaCnt = $('#essentialAddCnt'+cnt).val();
            eaCnt++;
            $('#essentialAddCnt'+cnt).val(eaCnt);
            if(!($('#GS_IDX_ADD'+cnt+'-'+rowData.GS_IDX).length>0)){
                var str = '';
                str += '<tr id="essentialAddTr'+cnt+'-'+eaCnt+'"><td>'+rowData.P_IDX+'</td><td>'+rowData.P_NAME+'</td><td>'+rowData.P_MODEL+'</td><td>'+rowData.GS_CODE+'</td><td>'+rowData.GS_NAME+'</td>';
                str += '<td>'+rowData.GS_RANK+'</td><td>'+rowData.OPTION1+'</td><td>'+rowData.OPTION2+'</td><td>'+rowData.OPTION3+'</td><td>'+rowData.SPEC_LOOKUP+'</td><td>'+comma(rowData.P_COST)+'</td>'
                str += '<td>'+comma(rowData.NAVER)+'</td><td>'+comma(rowData.P_RETAIL_PRICE)+'</td><td>'+comma(rowData.P_SELL_PRICE)+'</td><td>'+comma(rowData.GS_PRICE)+'</td>'
                str += '<td><input type="text" class="form-control text-right" name="SPO_MONEY_ADD'+cnt+'-'+rowData.GS_IDX+'" onkeyup="numCommaKeyUp()" value="'+comma(rowData.GS_PRICE)+'"><input type="hidden" name="GS_IDX_ADD'+cnt+'-'+rowData.GS_IDX+'" id="GS_IDX_ADD'+cnt+'-'+rowData.GS_IDX+'" value="'+rowData.GS_IDX+'"></td>'
                str += '<td><button onclick="deleteEssentialAdd('+cnt+','+eaCnt+')" class="btn btn-sm btn-secondary ml-1">삭제</button></td>'
                $('#essentialAddBody'+cnt).append(str);
            }

        }
        $('#searchGoodsStockModal').modal('hide');
    }

    function deleteEssentialAdd(cnt,eaCnt) {
        $('#essentialAddTr'+cnt+'-'+eaCnt).remove();
    }

    function saveShopProduct(){
        if(confirm("저장하시겠습니까?")){
            var param = new FormData($('#productForm')[0]);
            $.ajax({
                url:'/product/saveShopProduct.ajax',
                type:'post',
                processData:false,
                contentType:false,
                data:param,
                success: function(res){
                    if(res.message.indexOf('저장되었습니다.')!=-1){
                        window.location.reload();
                        opener.location.reload();
                    }
                }
            })
        }
    }

    function sumSpoMoney(){
        var sm1 = document.querySelectorAll('[name^="SPO_MONEY1"]')[0];
        var sm2 = document.querySelectorAll('[name^="SPO_MONEY2"]')[0];
        var sm3 = document.querySelectorAll('[name^="SPO_MONEY3"]')[0];
        var sm1_value=0;
        var sm2_value=0;
        var sm3_value=0;
        if(sm1!=undefined){
            sm1_value=sm1.value.replace(/[^0-9.]/gi,'');
            sm1_value=Number(sm1_value);
        }
        if(sm2!=undefined){
            sm2_value=sm2.value.replace(/[^0-9.]/gi,'');
            sm2_value=Number(sm2_value);
        }
        if(sm3!=undefined){
            sm3_value=sm3.value.replace(/[^0-9.]/gi,'');
            sm3_value=Number(sm3_value);
        }
        $('input[name="SP_SPO_SHOP_PRICE_SUM"]').val(comma(sm1_value+sm2_value+sm3_value));
    }

    function sumSpoDiscount(){
        var sd1 = document.querySelectorAll('[name^="SPO_DISCOUNT1"]')[0];
        var sd2 = document.querySelectorAll('[name^="SPO_DISCOUNT2"]')[0];
        var sd3 = document.querySelectorAll('[name^="SPO_DISCOUNT3"]')[0];
        var sd1_value=0;
        var sd2_value=0;
        var sd3_value=0;
        if(sd1!=undefined){
            sd1_value=sd1.value.replace(/[^0-9.]/gi,'');
            sd1_value=Number(sd1_value);
        }
        if(sd2!=undefined){
            sd2_value=sd2.value.replace(/[^0-9.]/gi,'');
            sd2_value=Number(sd2_value);
        }
        if(sd3!=undefined){
            sd3_value=sd3.value.replace(/[^0-9.]/gi,'');
            sd3_value=Number(sd3_value);
        }
        $('input[name="SP_SPO_PRICE_SUM"]').val(comma(sd1_value+sd2_value+sd3_value));
    }

</script>
<script th:inline="javascript">
    window.onload=function(){
        smImage('#summerNote1');
        smImage('#summerNote2');
    }
</script>

</html>
